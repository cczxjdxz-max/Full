# اسم سير العمل: محاولة البناء أو التشغيل
name: 1. Attempt to Build/Run

# المشغل: يعمل عند أي تحديث للكود
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # الخطوة 1: تشغيل عملية البناء أو الاختبار
      - name: "Run the build/test process"
        id: build_step
        run: |
          echo "Attempting to build the project in 'Full' repo..."
          # هذا السطر سيجعل المهمة تفشل عمداً لأغراض الاختبار
          exit 1
      
      # الخطوة 2: الإبلاغ عن النجاح (لن يتم الوصول إليها في هذا المثال)
      - name: "Report Success (if it happens)"
        if: success()
        run: echo "Build was successful!"

      # الخطوة 3: الإبلاغ عن الفشل إلى القائد (أهم خطوة)
      - name: "CRITICAL: Report Failure to Leader (avatar-template)"
        # يعمل فقط في حالة فشل الخطوات السابقة
        if: failure()
        run: |
          echo "Build failed. Reporting to the Leader at 'avatar-template'..."
          # استخدام cURL لإرسال إشارة "repository_dispatch" إلى مستودع القائد
          # تم تحديث اسم المستخدم في الرابط التالي
          curl -L \
            -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.PAT }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/cczxjdxz-max/avatar-template/dispatches \
            -d '{"event_type":"executor_failed", "client_payload": {"error_log":"Build failed with exit code 1", "goal":"Initial build test to trigger the Leader-Executor loop", "code_snippet":"exit 1"}}'
