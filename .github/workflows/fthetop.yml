name: GEASS-AUTO-SCREENSHOT

on:
  workflow_dispatch:

jobs:
  capture_gameplay:
    runs-on: macos-latest # نستخدم macOS لأنه يدعم المحاكاة (Emulator) بشكل أسرع
    steps:
      - name: 1. SET UP ANDROID EMULATOR
        uses: reactivecircus/android-emulator-runner@v2
        with:
          api-level: 29
          script: |
            # 2. تحميل النسخة النهائية التي بنيناها
            curl -L -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/releases/latest" | \
            grep "browser_download_url" | cut -d '"' -f 4 | xargs curl -L -o game.apk

            # 3. تثبيت اللعبة وتشغيلها
            adb install game.apk
            adb shell monkey -p com.geass.war.system -c android.intent.category.LAUNCHER 1
            
            echo "⏳ Waiting 60 seconds for the game to load and UI to appear..."
            sleep 60

            # 4. التقاط لقطة الشاشة
            adb shell screencap -p /sdcard/geass_view.png
            adb pull /sdcard/geass_view.png ./geass_final_view.png
            
            echo "✅ Screenshot captured successfully."

      - name: 5. UPLOAD SCREENSHOT AS ARTIFACT
        uses: actions/upload-artifact@v4
        with:
          name: Geass-Game-View
          path: geass_final_view.png