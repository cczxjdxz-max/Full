name: GIAS-MASTER-UNIVERSE-BUILDER

on:
  workflow_dispatch:

jobs:
  assemble_all:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Setup Environment
        run: pip install UnityPy

      - name: 2. Full Game Unpacking
        run: |
          wget -q -O game.apk "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
          unzip -o game.apk -d game_files

      - name: 3. The Grand Integration Script (Ø§Ù„Ø¯Ù…Ø¬ Ø§Ù„ÙƒÙ„ÙŠ)
        run: |
          cat << 'EOF' > grand_integrator.py
          import UnityPy
          import os
          import json

          # Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ù…ÙˆØ­Ø¯Ø© (ÙƒÙ„ Ù‚Ø³Ù… ÙÙŠ Ù…Ù„Ù ÙˆØ§Ø­Ø¯)
          master_folders = {
              "WORLD_GEOMETRY": [],   # Ø®Ø±ÙŠØ·Ø© Ø¨Ø±Ù…ÙˆØ¯Ø§ØŒ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³ØŒ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª
              "SKINS_LIBRARY": [],    # Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙƒÙ†Ø§Øª ÙˆØ§Ù„Ù…Ù„Ø§Ø¨Ø³
              "GAME_EVENTS": [],      # Ø§Ù„Ø£Ø­Ø¯Ø§Ø«ØŒ Ø§Ù„Ù…Ù‡Ø§Ù…ØŒ Ø§Ù„ØªÙˆÙ‚ÙŠØªØ§Øª
              "WEAPONS_SYSTEM": [],   # Ø§Ù„Ø£Ø³Ù„Ø­Ø©ØŒ Ø§Ù„Ù…Ù‚Ø°ÙˆÙØ§ØªØŒ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø­Ø±ÙƒØ© (Ù…Ø«Ù„ Ø§Ù„Ø®Ø·Ø§Ù)
              "EXPLOSIVES_DB": [],    # Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„ ÙˆØ§Ù„Ù…ØªÙØ¬Ø±Ø§Øª
              "CHARACTERS_PHYSICS": [], # Ø§Ù„Ø´Ø®ØµÙŠØ§ØªØŒ Ø§Ù„Ù‡ÙŠØª Ø¨ÙˆÙƒØ³ØŒ Ø§Ù„Ø¹Ø¸Ø§Ù…
              "PHYSICS_RULES": [],    # Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©ØŒ Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ØµØ§ØµØŒ Ø§Ù„Ø§Ø­ØªÙƒØ§Ùƒ
              "SYSTEM_LOGIC": []      # Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ØªØ­ÙƒÙ…ØŒ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†ØŒ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
          }

          # ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ù„Ù„ÙØ±Ø² Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (ØªØºØ·ÙŠ Ø­ØªÙ‰ Ù…Ù„ÙØ§Øª Ø§Ù„Ù€ 810 Ø¨Ø§ÙŠØª)
          tags = {
              "WORLD_GEOMETRY": [b"Bermuda", b"Map", b"Terrain", b"StaticMesh", b"Collision", b"Building"],
              "SKINS_COLLECTION": [b"Skin", b"Costume", b"Cloth", b"Bundle", b"Material", b"Preview"],
              "WEAPONS_SYSTEM": [b"Weapon", b"Gun", b"Rifle", b"Ammo", b"Recoil", b"Hook", b"Grappling"],
              "EXPLOSIVES_DB": [b"Grenade", b"Bomb", b"Explosion", b"Flashbang", b"Mine"],
              "CHARACTERS_PHYSICS": [b"Character", b"Hero", b"Skill", b"Avatar", b"Hitbox", b"Bone", b"Skeleton"],
              "PHYSICS_RULES": [b"Physics", b"Gravity", b"Mass", b"Friction", b"Velocity", b"Trajectory"],
              "SYSTEM_LOGIC": [b"Manager", b"System", b"Config", b"Setting", b"Rule", b"Logic"],
              "GAME_EVENTS": [b"Event", b"Mission", b"Quest", b"Reward", b"Activity", b"BattlePass"]
          }

          print("ğŸš€ Reconstructing the Game Universe into Unified Master Files...")

          for root, dirs, files in os.walk("game_files"):
              for file in files:
                  try:
                      env = UnityPy.load(os.path.join(root, file))
                      for obj in env.objects:
                          # Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù‡ÙŠÙƒÙ„ Ø£Ùˆ Ø®Ø§Ù…)
                          try:
                              data = obj.read().read_typetree()
                          except:
                              data = {"f_id": file, "type": obj.type.name, "raw_hex": obj.get_raw_data().hex()[:1000]}
                          
                          # ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù†Øµ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨ØµÙ…Ø© ÙˆØªØµÙ†ÙŠÙÙ‡Ø§
                          data_str = str(data).encode()
                          classified = False
                          for category, keys in tags.items():
                              if any(k in data_str for k in keys):
                                  master_folders[category].append(data)
                                  classified = True
                                  break
                          
                          # Ø¥Ø°Ø§ Ù„Ù… ÙŠØµÙ†ÙØŒ ÙŠÙˆØ¶Ø¹ ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ø§Ù…
                          if not classified and obj.type.name in ["MonoBehaviour", "TextAsset"]:
                              master_folders["SYSTEM_LOGIC"].append(data)
                  except: continue

          # Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚Ø©
          os.makedirs("FINAL_AI_READY_DATA", exist_ok=True)
          for category, content in master_folders.items():
              if content:
                  print(f"ğŸ’¾ Exporting Master File: {category} (Entries: {len(content)})")
                  with open(f"FINAL_AI_READY_DATA/{category}.json", "w", encoding='utf-8') as f:
                      json.dump(content, f, ensure_ascii=False)

          print("âœ… All game systems have been merged into 8 Master Files!")
          EOF
          python3 grand_integrator.py

      - name: 4. Upload Complete Dataset
        uses: actions/upload-artifact@v4
        with:
          name: FULL_FREEFIRE_AI_DATASET
          path: FINAL_AI_READY_DATA/