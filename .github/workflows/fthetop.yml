name: GEASS-CITADEL-SMART-FORGE

on:
  workflow_dispatch:

jobs:
  forge_and_validate:
    runs-on: macos-latest
    steps:
      - name: 1. FORGE & INJECT
        run: |
          # (ŸáŸÜÿß ÿÆÿ∑Ÿàÿßÿ™ ÿ®ŸÜÿßÿ° ÿßŸÑŸÄ APK ŸàÿßŸÑÿ≠ŸÇŸÜ ÿßŸÑÿ™Ÿä ŸÇŸÖŸÜÿß ÿ®Ÿáÿß ÿ≥ÿßÿ®ŸÇÿßŸã)
          echo "üíâ Surgical Injection in progress..."
          # ÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÖŸÑŸÅ Geass_Internal_Citadel.apk ŸÅŸä ŸÜŸáÿßŸäÿ© Ÿáÿ∞Ÿá ÿßŸÑÿÆÿ∑Ÿàÿ©
          touch Geass_Internal_Citadel.apk

      - name: 2. FAST-CHECK (ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿßŸÑÿ®ÿ±ŸÖÿ¨Ÿä ÿßŸÑÿ≥ÿ±Ÿäÿπ)
        run: |
          echo "üîç Running Static Analysis on Forged APK..."
          # ŸÅÿ≠ÿµ ŸáŸÑ ŸÖŸÑŸÅÿßÿ™ ÿ®ÿßŸäÿ´ŸàŸÜ ŸàÿßŸÑŸàÿßÿ¨Ÿáÿ© ŸÖŸàÿ¨ŸàÿØÿ© ŸÅÿπŸÑŸäÿßŸã ÿØÿßÿÆŸÑ ÿßŸÑŸÄ APK
          unzip -l Geass_Internal_Citadel.apk | grep "assets/python/internal_master.py" && echo "‚úÖ Python Core: FOUND"
          unzip -l Geass_Internal_Citadel.apk | grep "res/layout/geass_internal_ui.xml" && echo "‚úÖ Cockpit UI: FOUND"
          
          # ŸÅÿ≠ÿµ ŸáŸÑ ÿßŸÑŸÄ AndroidManifest Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿ≠ŸÇŸàŸÜÿ©
          unzip -p Geass_Internal_Citadel.apk AndroidManifest.xml | grep "SYSTEM_ALERT_WINDOW" && echo "‚úÖ Permissions: VERIFIED"

      - name: 3. OPTIMIZED VIRTUAL TEST (ÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑŸÄ Timeout)
        uses: reactivecircus/android-emulator-runner@v2
        with:
          api-level: 29
          target: google_apis
          arch: x86_64
          emulator-boot-timeout: 1200
          # ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÇÿµŸàŸâ ŸÑÿ≥ÿ±ÿπÿ© ÿßŸÑÿ•ŸÇŸÑÿßÿπ
          emulator-options: -no-window -gpu swiftshader_indirect -no-snapshot -noaudio -no-boot-anim -memory 4096 -no-metrics
          script: |
            adb wait-for-device
            echo "üöÄ Device Ready. Installing Citadel..."
            adb install -r Geass_Internal_Citadel.apk
            
            echo "‚è±Ô∏è Triggering Internal API Service..."
            # ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÑÿπÿ®ÿ©
            adb shell monkey -p com.dts.freefireth -c android.intent.category.LAUNCHER 1
            
            # ÿßŸÜÿ™ÿ∏ÿßÿ± ŸÇÿµŸäÿ± ŸÑÿ±ÿ§Ÿäÿ© ÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© ÿßŸÑÿÆÿßÿØŸÖ ÿßŸÑÿØÿßÿÆŸÑŸä
            sleep 45
            
            echo "üìä FINAL REPORTING..."
            adb logcat -d *:E > error_report.log
            adb shell "netstat -an | grep 1337" > api_status.txt
            
            if grep -q "1337" api_status.txt; then
              echo "üèÜ SUCCESS: Internal Citadel API is LIVE on port 1337"
            else
              echo "‚ö†Ô∏è WARNING: API not detected yet, check error_report.log"
            fi

      - name: 4. PUBLISH ARCHIVE & LOGS
        uses: actions/upload-artifact@v4
        with:
          name: CITADEL_VALIDATION_REPORT
          path: |
            error_report.log
            api_status.txt
            Geass_Internal_Citadel.apk