name: GIAS-HEX-FORCE-EXTRACTOR

on:
  workflow_dispatch: # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ

jobs:
  force_extract:
    runs-on: ubuntu-latest
    steps:
      # 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ¦Ø©
      - name: 1. Setup Environment
        run: |
          pip install UnityPy
          echo "--- Environment Ready ---"

      # 2. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆÙÙƒÙ‡Ø§
      - name: 2. Download & Unpack APK
        run: |
          echo "--- Downloading APK ---"
          wget -q -O game.apk "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
          echo "--- Unpacking APK ---"
          unzip -o game.apk -d game_files

      # 3. Ù…Ø­Ø±Ùƒ Ø§Ù„ÙÙ‡Ø±Ø³Ø© ÙˆØ§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù‚Ø³Ø±ÙŠ
      - name: 3. Master Force Extraction
        run: |
          cat << 'EOF' > force_extractor.py
          import os
          import json
          import UnityPy
          import struct

          # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
          target_dir = "game_files"
          output_dir = "FINAL_DATA"
          os.makedirs(output_dir, exist_ok=True)

          inventory = {
              "Weapons_Logic": [],
              "Physics_and_Rules": [],
              "Raw_Analysis": {}
          }

          # ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©
          keywords = {
              "Weapons_Logic": [b"Weapon", b"Recoil", b"Bullet", b"Spread"],
              "Physics_and_Rules": [b"Gravity", b"Physics", b"SpeedScale", b"Movement"]
          }

          print("ğŸ“¡ Starting Force Extraction on 40,000+ files...")

          # Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ù…Ù„
          for root, dirs, files in os.walk(target_dir):
              for file in files:
                  f_path = os.path.join(root, file)
                  f_size = os.path.getsize(f_path)
                  
                  if f_size < 1000: continue # ØªØ®Ø·ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø¬Ø¯Ø§Ù‹

                  try:
                      with open(f_path, 'rb') as f_raw:
                          content = f_raw.read()
                          
                          is_target = False
                          category = ""
                          for cat, keys in keywords.items():
                              if any(k in content for k in keys):
                                  is_target = True
                                  category = cat
                                  break
                          
                          if is_target:
                              # Ø¥Ø°Ø§ ÙˆØ¬Ø¯Ù†Ø§ Ù…Ù„Ù Ù‡Ø¯ÙØŒ Ù†Ù‚ÙˆÙ… Ø¨ØªØ´Ø±ÙŠØ­Ù‡ ÙÙˆØ±Ø§Ù‹
                              env = UnityPy.load(f_path)
                              for obj in env.objects:
                                  raw_payload = obj.get_raw_data()
                                  
                                  if len(raw_payload) > 10:
                                      # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù‚ÙŠÙ… Ø§Ù„Ù€ Floats (Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªÙŠ ØªÙ…Ø«Ù„ Ø§Ù„Ø§Ø±ØªØ¯Ø§Ø¯ ÙˆØ§Ù„Ø³Ø±Ø¹Ø©)
                                      detected_floats = []
                                      for i in range(0, len(raw_payload) - 4, 4):
                                          try:
                                              f_val = struct.unpack('f', raw_payload[i:i+4])[0]
                                              # ØªØµÙÙŠØ© Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ© Ù„Ù„Ø¹Ø¨Ø© (ØºØ§Ù„Ø¨Ø§Ù‹ ØªÙƒÙˆÙ† Ø¨ÙŠÙ† 0 Ùˆ 100)
                                              if 0.001 < f_val < 100.0:
                                                  detected_floats.append(round(f_val, 4))
                                          except: continue

                                      inventory["Raw_Analysis"][f"{file}_{obj.type.name}"] = {
                                          "file_path": f_path,
                                          "size": len(raw_payload),
                                          "hex_preview": raw_payload[:64].hex(' '),
                                          "floats": list(set(detected_floats))[:30] # Ø£ÙˆÙ„ 30 Ø±Ù‚Ù… ÙØ±ÙŠØ¯
                                      }
                                      print(f"ğŸ¯ Analysis Done: {file}")
                  except:
                      continue

          # Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
          with open(f"{output_dir}/RAW_PHYSICS_ANALYSIS.json", "w", encoding='utf-8') as f:
              json.dump(inventory, f, indent=4)
          
          print(f"âœ… Mission Success! Data saved in {output_dir}")
          EOF
          python3 force_extractor.py

      # 4. Ø±ÙØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙƒÙ€ Artifact
      - name: 4. Upload Final Results
        uses: actions/upload-artifact@v4
        with:
          name: GIAS_FINAL_RAW_DATA
          path: FINAL_DATA/