name: GIAS-ABSOLUTE-AI-EXTRACTOR
on:
  workflow_dispatch:

jobs:
  full_extraction:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Setup Data Tools
        run: pip install UnityPy numpy

      - name: 2. Full Game Download
        run: |
          wget -q -O game.apk "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
          unzip -o game.apk -d game_files

      - name: 3. The Master Aggregator (Ø§Ù„Ù…Ø¬Ù…Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ)
        run: |
          cat << 'EOF' > final_aggregator.py
          import UnityPy
          import os
          import json

          # Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø© Ø§Ù„ØªÙŠ Ø·Ù„Ø¨ØªÙ‡Ø§
          ai_database = {
              "BERMUDA_FULL": [],      # Ø§Ù„Ø®Ø±Ø§Ø¦Ø·ØŒ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³ØŒ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª
              "SKINS_MASTER": [],      # ÙƒÙ„ Ø§Ù„Ø³ÙƒÙ†Ø§Øª ÙˆØ§Ù„Ù…Ù„Ø§Ø¨Ø³
              "EVENTS_LOGIC": [],      # Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙˆØ§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ù…Ù†Ø·Ù‚
              "WEAPONS_ALL": [],       # ÙƒÙ„ Ø§Ù„Ø£Ø³Ù„Ø­Ø©ØŒ Ø§Ù„Ù…Ù‚Ø°ÙˆÙØ§ØªØŒ Ø§Ù„Ø®Ø·Ø§Ù
              "GRENADES_DB": [],       # Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„ ÙˆØ§Ù„Ù…ØªÙØ¬Ø±Ø§Øª
              "CHARACTERS_DATA": [],   # Ø§Ù„Ø´Ø®ØµÙŠØ§ØªØŒ Ø§Ù„Ù‡ÙŠØª Ø¨ÙˆÙƒØ³ØŒ Ø§Ù„Ø¹Ø¸Ø§Ù…
              "PHYSICS_MASTER": [],    # Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ ÙˆØ§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© (Ù…Ø«Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø°ÙŠ Ø±ÙØ¹ØªÙ‡)
              "CORE_LOGIC": []         # Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¹Ø§Ù… ÙˆØ§Ù„Ø³ÙŠØ³ØªÙ…
          }

          # ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ù„Ù„ØªØµÙ†ÙŠÙ ÙˆØ§Ù„Ø¯Ù…Ø¬
          tags = {
              "BERMUDA_FULL": [b"Bermuda", b"Map", b"Terrain", b"StaticMesh", b"Collision"],
              "SKINS_MASTER": [b"Skin", b"Costume", b"Cloth", b"Bundle", b"Material"],
              "EVENTS_LOGIC": [b"Event", b"Mission", b"Quest", b"Activity", b"BattlePass"],
              "WEAPONS_ALL": [b"Weapon", b"Gun", b"Recoil", b"Hook", b"Grappling", b"Ammo"],
              "GRENADES_DB": [b"Grenade", b"Bomb", b"Explosion", b"Flashbang", b"Mine"],
              "CHARACTERS_DATA": [b"Character", b"Hero", b"Skill", b"Avatar", b"Hitbox", b"Bone"],
              "PHYSICS_MASTER": [b"Physics", b"Gravity", b"Mass", b"Velocity", b"PhysicsManager"],
              "CORE_LOGIC": [b"Manager", b"System", b"Config", b"Rule", b"Logic"]
          }

          print("ğŸš€ Starting the Absolute Aggregation of 40,000+ files...")

          for root, dirs, files in os.walk("game_files"):
              for file in files:
                  try:
                      env = UnityPy.load(os.path.join(root, file))
                      for obj in env.objects:
                          try:
                              data = obj.read().read_typetree()
                          except:
                              data = {"f_id": file, "type": obj.type.name, "hex": obj.get_raw_data().hex()[:1000]}
                          
                          data_str = str(data).encode()
                          for category, keywords in tags.items():
                              if any(k in data_str for k in keywords):
                                  ai_database[category].append(data)
                                  break
                  except: continue

          # Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¶Ø®Ù…Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
          os.makedirs("FINAL_AI_WORLD", exist_ok=True)
          for category, content in ai_database.items():
              print(f"ğŸ’¾ Saving Master File: {category} (Size: {len(content)} objects)")
              with open(f"FINAL_AI_WORLD/{category}.json", "w", encoding='utf-8') as f:
                  json.dump(content, f, ensure_ascii=False)

          print("âœ… MISSION COMPLETE: All game data merged into 8 Master Files!")
          EOF
          python3 final_aggregator.py

      - name: 4. Export AI Biome
        uses: actions/upload-artifact@v4
        with:
          name: FULL_FREEFIRE_MASTER_DATASET
          path: FINAL_AI_WORLD/