name: GIAS-AI-TOTAL-ARCHIVE-V2
on:
  workflow_dispatch:

jobs:
  build_mega_archive:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Environment Setup
        run: pip install UnityPy numpy

      - name: 2. Full APK Extraction
        run: |
          wget -q -O game.apk "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
          unzip -o game.apk -d game_files

      - name: 3. The Ultimate Merger Script
        run: |
          cat << 'EOF' > ultimate_merger.py
          import UnityPy
          import os
          import json

          # Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¶Ø®Ù…Ø©
          mega_archive = {
              "MAP_BERMUDA": [],      # Ø®Ø±Ø§Ø¦Ø·ØŒ ØªØ¶Ø§Ø±ÙŠØ³ØŒ ÙƒÙˆÙ„ÙŠØ¯Ø±Ø²
              "SKINS_ASSETS": [],     # Ø¬Ù„ÙˆØ¯ØŒ Ù…Ù„Ø§Ø¨Ø³ØŒ Ù†Ù…Ø§Ø°Ø¬ Ø¨ØµØ±ÙŠÙ‘Ø©
              "GAME_LOGIC": [],       # Ø£Ø­Ø¯Ø§Ø«ØŒ Ø£Ù†Ø¸Ù…Ø©ØŒ Ù‚ÙˆØ§Ù†ÙŠÙ†
              "WEAPONS_PHYSICS": [],  # Ø£Ø³Ù„Ø­Ø©ØŒ Ø§Ø±ØªØ¯Ø§Ø¯ØŒ Ù‚Ù†Ø§Ø¨Ù„ØŒ ÙÙŠØ²ÙŠØ§Ø¡
              "CHARACTERS": []        # Ø´Ø®ØµÙŠØ§ØªØŒ Ù‚Ø¯Ø±Ø§ØªØŒ Ø¹Ø¸Ø§Ù… (Skeletons)
          }

          # Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ù„Ù„Ø¨ØµÙ…Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
          map_keys = [b"Bermuda", b"Map", b"Terrain", b"StaticMesh"]
          skin_keys = [b"Skin", b"Costume", b"Cloth", b"Bundle", b"Material"]
          logic_keys = [b"Manager", b"System", b"Event", b"Config", b"Rule"]
          physics_keys = [b"Weapon", b"Recoil", b"Physics", b"Bullet", b"Grenade", b"Gravity"]
          char_keys = [b"Character", b"Hero", b"Skill", b"Avatar", b"Hitbox", b"Bone"]

          print("ğŸ§¬ Starting Global Data Merging for AI Training...")

          for root, dirs, files in os.walk("game_files"):
              for file in files:
                  try:
                      env = UnityPy.load(os.path.join(root, file))
                      for obj in env.objects:
                          # Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ€ Typetree Ø£Ùˆ Raw Hex Ø¥Ø°Ø§ ÙØ´Ù„
                          try:
                              data = obj.read().read_typetree()
                          except:
                              data = {"raw_id": obj.path_id, "type": obj.type.name, "hex": obj.get_raw_data().hex()[:1000]}

                          # ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù†Øµ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨ØµÙ…Ø©
                          search_str = str(data).encode()

                          # Ø§Ù„ØªØµÙ†ÙŠÙ ÙˆØ§Ù„Ø¯Ù…Ø¬ Ø§Ù„Ù‚Ø³Ø±ÙŠ
                          if any(k in search_str for k in map_keys):
                              mega_archive["MAP_BERMUDA"].append(data)
                          elif any(k in search_str for k in skin_keys):
                              mega_archive["SKINS_ASSETS"].append(data)
                          elif any(k in search_str for k in physics_keys):
                              mega_archive["WEAPONS_PHYSICS"].append(data)
                          elif any(k in search_str for k in char_keys):
                              mega_archive["CHARACTERS"].append(data)
                          elif any(k in search_str for k in logic_keys):
                              mega_archive["GAME_LOGIC"].append(data)
                  except: continue

          # Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¶Ø®Ù…Ø©
          os.makedirs("MEGA_ARCHIVE", exist_ok=True)
          for category, content in mega_archive.items():
              print(f"ğŸ’¾ Saving {category}... Total items: {len(content)}")
              with open(f"MEGA_ARCHIVE/{category}.json", "w", encoding='utf-8') as f:
                  json.dump(content, f, ensure_ascii=False)
          
          print("âœ… Mega Archive Construction Complete!")
          EOF
          python3 ultimate_merger.py

      - name: 4. Export Mega Archive
        uses: actions/upload-artifact@v4
        with:
          name: AI_FULL_DATASET_V2
          path: MEGA_ARCHIVE/