# .github/workflows/geass-citadel-direct-test.yml
name: GEASS-CITADEL-DIRECT-TEST

on:
  workflow_dispatch:

jobs:
  download_and_test:
    runs-on: macos-latest # Ù…Ø·Ù„ÙˆØ¨ Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ Ø¨ÙƒÙØ§Ø¡Ø©
    steps:
      # --- Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ APK Ø§Ù„Ø¬Ø§Ù‡Ø² ---
      - name: 1. DOWNLOAD PRE-BUILT CITADEL APK
        run: |
          echo "ğŸ“¥ Downloading the pre-built APK from the provided direct link..."
          # Ø§Ø³ØªØ®Ø¯Ø§Ù… curl Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ Ø£Ø¹Ø·ÙŠØªÙ‡
          # -L ÙŠØªØ¨Ø¹ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ§Øª Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡
          # -o ÙŠØ³Ù…ÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ø§ØªØ¬
          curl -L "https://release-assets.githubusercontent.com/github-production-release-asset/1140560756/2ba806ea-4930-426a-ac86-c5c58fa7e548?sp=r&sv=2018-11-09&sr=b&spr=https&se=2026-02-02T23%3A06%3A01Z&rscd=attachment%3B+filename%3DGeass_Internal_Citadel.apk&rsct=application%2Fvnd.android.package-archive&skoid=96c2d410-5711-43a1-aedd-ab1947aa7ab0&sktid=398a6654-997b-47e9-b12b-9515b896b4de&skt=2026-02-02T22%3A05%3A36Z&ske=2026-02-02T23%3A06%3A01Z&sks=b&skv=2018-11-09&sig=s4ghLatFIhueRhPtuyibj%2FPNH5D6V9uQgXSMKbf8Hvo%3D&jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmVsZWFzZS1hc3NldHMuZ2l0aHVidXNlcmNvbnRlbnQuY29tIiwia2V5Ijoia2V5MSIsImV4cCI6MTc3MDA3MzUzNiwibmJmIjoxNzcwMDY5OTM2LCJwYXRoIjoicmVsZWFzZWFzc2V0cHJvZHVjdGlvbi5ibG9iLmNvcmUud2luZG93cy5uZXQifQ.-bz5Bm2bGcr_BAYm6bOdMcsmJzHRZS7g4AjLvwXmPoc&response-content-disposition=attachment%3B%20filename%3DGeass_Internal_Citadel.apk&response-content-type=application%2Fvnd.android.package-archive" -o Geass_Internal_Citadel.apk
          
          echo "âœ… APK downloaded successfully."
          # ÙØ­Øµ Ø¨Ø³ÙŠØ· Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù Ù„ÙŠØ³ ÙØ§Ø±ØºØ§Ù‹
          if [ ! -s Geass_Internal_Citadel.apk ]; then
            echo "âŒ Error: Download failed or file is empty."
            exit 1
          fi

      # --- Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­ÙŠ (Ø§Ù„ØªØ¬Ø±Ø¨Ø©) ---
      - name: 2. VIRTUAL FIELD TEST (Try Before You Download)
        uses: reactivecircus/android-emulator-runner@v2
        with:
          api-level: 29
          target: google_apis
          arch: x86_64
          emulator-options: -no-window -gpu swiftshader_indirect -no-snapshot -noaudio -no-boot-anim
          script: |
            echo "âœ… Emulator is online. Preparing for live test..."
            adb wait-for-device
            
            echo "ğŸ“² Installing the downloaded Citadel APK..."
            adb install -r Geass_Internal_Citadel.apk
            
            echo "ğŸš€ Launching game to verify cockpit appearance..."
            # Ø§Ø³ØªØ®Ø¯Ø§Ù… monkey Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©
            adb shell monkey -p com.dts.freefireth -c android.intent.category.LAUNCHER 1
            
            echo "â³ Waiting 30 seconds for the game to load and cockpit to appear..."
            sleep 30
            
            echo "ğŸ“¸ Capturing LIVE PROOF..."
            adb exec-out screencap -p > live_proof.png
            echo "âœ… Live proof captured."

      # --- Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: Ø±ÙØ¹ Ø§Ù„Ø¯Ù„ÙŠÙ„ ---
      - name: 3. UPLOAD LIVE PROOF
        uses: actions/upload-artifact@v4
        with:
          name: LIVE_TEST_PROOF
          path: live_proof.png
          
      - name: 4. FINAL NOTIFICATION
        run: |
          echo "ğŸ‰ Test complete! You can now download the 'live_proof.png' from the artifacts section to see the result."
