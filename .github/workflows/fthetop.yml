name: GIAS-THE-ABSOLUTE-ARCHIVE

on:
  workflow_dispatch:

jobs:
  build_master_dataset:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Setup
        run: pip install UnityPy

      - name: 2. Extract APK
        run: |
          wget -q -O game.apk "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
          unzip -o game.apk -d game_files

      - name: 3. The Mega-Merge Script
        run: |
          cat << 'EOF' > mega_merger.py
          import UnityPy
          import os
          import json

          # Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø© Ø§Ù„ØªÙŠ Ø·Ù„Ø¨ØªÙ‡Ø§
          master_archive = {
              "BERMUDA_MAP": [],      # ÙƒÙ„ Ù…Ø§ ÙŠØ®Øµ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ§Ù„ØªØ¯Ù…ÙŠØ±
              "SKINS_MASTER": [],     # Ø§Ù„Ø³ÙƒÙ†Ø§Øª ÙˆØ§Ù„Ø£Ø´ÙƒØ§Ù„
              "EVENTS_DATA": [],      # Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙˆØ§Ù„Ø¨Ø±Ù…Ø¬Ø©
              "WEAPONS_MASTER": [],   # Ø§Ù„Ø£Ø³Ù„Ø­Ø© ÙˆØ§Ù„Ù‚Ù†Ø§Ø¨Ù„
              "CHARACTERS_DATA": [],  # Ø§Ù„Ø´Ø®ØµÙŠØ§Øª ÙˆØ§Ù„Ù‡ÙŠØª Ø¨ÙˆÙƒØ³
              "PHYSICS_LOGIC": []     # Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ ÙˆØ§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ø§Ù…
          }

          # Ø§Ù„ØªØµÙ†ÙŠÙ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù (Ø­ØªÙ‰ Ø§Ù„Ù€ 702 Ø¨Ø§ÙŠØª Ø³ÙŠØªÙ… ØªØµÙ†ÙŠÙÙ‡Ø§ Ù‡Ù†Ø§)
          tags = {
              "BERMUDA_MAP": [b"Bermuda", b"Map", b"Terrain", b"Destructible", b"StaticMesh"],
              "SKINS_MASTER": [b"Skin", b"Costume", b"Cloth", b"Bundle", b"Preview"],
              "WEAPONS_MASTER": [b"Weapon", b"Gun", b"Recoil", b"Grenade", b"Hook", b"Ammo"],
              "CHARACTERS_DATA": [b"Character", b"Hero", b"Skill", b"Avatar", b"Hitbox"],
              "PHYSICS_LOGIC": [b"Physics", b"Gravity", b"Manager", b"System", b"Rule"],
              "EVENTS_DATA": [b"Event", b"Mission", b"Quest", b"Activity"]
          }

          print("ğŸ§¬ Merging 40,000 files into Master Archives...")

          for root, dirs, files in os.walk("game_files"):
              for file in files:
                  try:
                      env = UnityPy.load(os.path.join(root, file))
                      for obj in env.objects:
                          # Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù‡ÙŠÙƒÙ„ Ø£Ùˆ Ø®Ø§Ù…)
                          try:
                              data = obj.read().read_typetree()
                          except:
                              data = {"f_id": file, "hex": obj.get_raw_data().hex()[:2000]}

                          # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
                          data_str = str(data).encode()
                          for category, keys in tags.items():
                              if any(k in data_str for k in keys):
                                  master_archive[category].append(data)
                                  break
                  except: continue

          # Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¶Ø®Ù…Ø©
          os.makedirs("MASTER_DATASET", exist_ok=True)
          for cat, content in master_archive.items():
              print(f"ğŸ’¾ Saving {cat}: {len(content)} entries found.")
              with open(f"MASTER_DATASET/{cat}.json", "w", encoding='utf-8') as f:
                  json.dump(content, f, ensure_ascii=False)
          
          print("âœ… All files merged into single category masters!")
          EOF
          python3 mega_merger.py

      - name: 4. Upload Dataset
        uses: actions/upload-artifact@v4
        with:
          name: FULL_AI_DATASET_READY
          path: MASTER_DATASET/