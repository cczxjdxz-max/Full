name: GEASS-FINAL-CHECK

on:
  workflow_dispatch:

jobs:
  audit:
    runs-on: ubuntu-latest
    steps:
      - name: 1. FETCH MASTER APK
        uses: dsaltares/fetch-gh-release-asset@master
        with:
          version: 'latest'
          file: 'Geass_Master_Final.apk'
          target: './master.apk'
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: 2. RUN FORENSIC ANALYSIS
        run: |
          sudo apt-get update && sudo apt-get install -y apksigner
          
          echo "ðŸ”Ž Analyzing Signature Schemes..."
          apksigner verify --verbose master.apk > full_report.txt
          
          echo "ðŸ”Ž Analyzing Manifest Permissions..."
          unzip -p master.apk AndroidManifest.xml > m_dump
          strings m_dump | grep "SYSTEM_ALERT_WINDOW" >> full_report.txt || echo "PERMISSION_MISSING" >> full_report.txt
          
          echo "ðŸ”Ž Analyzing Injected Assets..."
          unzip -l master.apk | grep "assets/python/internal_master.py" >> full_report.txt

      - name: 3. FINAL VERDICT (Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ)
        run: |
          echo "### ðŸ”± GEASS MASTER READINESS REPORT ðŸ”±" >> $GITHUB_STEP_SUMMARY
          echo "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© (V4.0 Master):" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± | Ø§Ù„Ø­Ø§Ù„Ø© | Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© |" >> $GITHUB_STEP_SUMMARY
          echo "| :--- | :--- | :--- |" >> $GITHUB_STEP_SUMMARY
          
          # ÙØ­Øµ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹
          if grep -q "Verified using v2 scheme: true" full_report.txt; then
            echo "| Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ | âœ… Ù…Ù…ØªØ§Ø² | ÙŠØ¯Ø¹Ù… V2/V3 (Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ«Ø¨ÙŠØª) |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ | âš ï¸ Ø¶Ø¹ÙŠÙ | Ù‚Ø¯ ÙŠØ±ÙØ¶Ù‡ Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ 12+ |" >> $GITHUB_STEP_SUMMARY
          fi
          
          # ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
          if grep -q "SYSTEM_ALERT_WINDOW" full_report.txt; then
            echo "| Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© | âœ… Ù…ÙØ¹Ù„Ø© | ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø±Ø³Ù… ÙÙˆÙ‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© | âŒ Ù…ÙÙ‚ÙˆØ¯Ø© | Ù„Ù† ØªØ¸Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø© |" >> $GITHUB_STEP_SUMMARY
          fi
          
          # ÙØ­Øµ Ø§Ù„Ø¨Ø§ÙŠØ«ÙˆÙ†
          if grep -q "assets/python/internal_master.py" full_report.txt; then
            echo "| Ù…Ø­Ø±Ùƒ Ø§Ù„Ø­Ù‚Ù† | âœ… Ù†Ø´Ø· | Ù…Ù„Ù Ø§Ù„Ø¨Ø§ÙŠØ«ÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­ |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| Ù…Ø­Ø±Ùƒ Ø§Ù„Ø­Ù‚Ù† | âŒ ÙØ´Ù„ | Ù…Ù„Ù Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ù…ÙÙ‚ÙˆØ¯ |" >> $GITHUB_STEP_SUMMARY
          fi

      - name: 4. CLEANUP & LOGS
        uses: actions/upload-artifact@v4
        with:
          name: FINAL_VERIFICATION_LOGS
          path: full_report.txt