# .github/workflows/geass-cockpit-restoration.yml
name: GEASS-COCKPIT-RESTORATION

on:
  workflow_dispatch:

jobs:
  forge_cockpit_apk:
    runs-on: ubuntu-latest
    steps:
      - name: 1. FORGE_STATION_PREP
        run: |
          sudo apt-get update
          sudo apt-get install -y openjdk-17-jdk apksigner wget zip unzip g++-aarch64-linux-gnu
          curl -L "https://bitbucket.org/iBotPeaches/apktool/downloads/apktool_2.9.3.jar" -o apktool.jar
          mkdir -p ./GEASS/payload/lib ./GEASS/payload/res/layout ./GEASS/final_apk
          echo "âœ… Forge Station Ready."

      - name: 2. RESTORE_COCKPIT_UI (XML)
        run: |
          echo "ğŸ¨ Restoring the Floating Command Console..."
          cat << 'EOF' > ./GEASS/payload/res/layout/layout_geass.xml
          <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
              android:layout_width="400dp"
              android:layout_height="wrap_content"
              android:orientation="vertical"
              android:background="#BF000000"
              android:padding="10dp">
              <TextView
                  android:layout_width="wrap_content"
                  android:layout_height="wrap_content"
                  android:text="GEASS SOVEREIGN CONSOLE"
                  android:textColor="#FFC107"
                  android:textSize="18sp"
                  android:layout_gravity="center_horizontal"/>
              <EditText
                  android:id="@+id/python_code_editor"
                  android:layout_width="match_parent"
                  android:layout_height="180dp"
                  android:hint="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø¨Ø§ÙŠØ«ÙˆÙ† Ù‡Ù†Ø§..."
                  android:background="#E6FFFFFF"
                  android:textColor="#000000"
                  android:gravity="top|start"
                  android:padding="5dp"/>
              <Button
                  android:id="@+id/execute_button"
                  android:layout_width="match_parent"
                  android:layout_height="wrap_content"
                  android:text="Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…Ø± (EXECUTE)"
                  android:backgroundTint="#FF5722"/>
              <Switch
                  android:id="@+id/mode_switch"
                  android:layout_width="wrap_content"
                  android:layout_height="wrap_content"
                  android:text="ÙˆØ¶Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Data) / Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠØ§Øª (720P)"
                  android:textColor="#FFFFFF"
                  android:layout_gravity="center_horizontal"/>
          </LinearLayout>
          EOF
          echo "âœ… Cockpit UI Blueprinted."

      - name: 3. FORGE_NEURAL_BRIDGE_WITH_UI_LINKS
        run: |
          echo "ğŸ”— Linking UI Elements to Python Core..."
          JAVA_HOME_PATH="/usr/lib/jvm/java-17-openjdk-amd64"
          cat << 'EOF' > bridge.cpp
          #include <jni.h>
          extern "C" int __android_log_print(int prio, const char* tag, const char* fmt, ...);
          extern "C" {
              // Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙŠØ³ØªØ¯Ø¹ÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø©
              JNIEXPORT void JNICALL
              Java_com_geass_Sovereign_onExecuteClick(JNIEnv* env, jobject obj, jstring code) {
                  const char* pyCode = env->GetStringUTFChars(code, NULL);
                  __android_log_print(4, "GEASS_COCKPIT", "Executing from UI: %s", pyCode);
                  env->ReleaseStringUTFChars(code, pyCode);
              }
              // Ø§Ù„Ø³ÙˆÙŠØªØ´ ÙŠØ³ØªØ¯Ø¹ÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† 720P Ùˆ Data Mode
              JNIEXPORT void JNICALL
              Java_com_geass_Sovereign_onModeToggle(JNIEnv* env, jobject obj, jboolean isDataMode) {
                  __android_log_print(4, "GEASS_COCKPIT", "Mode Switched: %s", isDataMode ? "Data" : "720P");
              }
          }
          EOF
          aarch64-linux-gnu-g++ -shared -fPIC -I"$JAVA_HOME_PATH/include" -I"$JAVA_HOME_PATH/include/linux" bridge.cpp -o ./GEASS/payload/lib/libgeass_bridge.so

      - name: 4. FINAL_SURGICAL_INTEGRATION
        run: |
          wget -q -O Target.apk "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
          java -jar apktool.jar d Target.apk -o decoded_source
          
          # Ø­Ù‚Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù…)
          mkdir -p decoded_source/res/layout/
          cp ./GEASS/payload/res/layout/layout_geass.xml decoded_source/res/layout/
          
          # Ø­Ù‚Ù† Ø§Ù„Ø¬Ø³Ø± ÙˆØ§Ù„Ù…ØªØ±Ø¬Ù…
          mkdir -p decoded_source/lib/arm64-v8a/
          cp ./GEASS/payload/lib/libgeass_bridge.so decoded_source/lib/arm64-v8a/
          wget -q -O decoded_source/lib/arm64-v8a/libpython3.so "https://github.com/termux/termux-packages/raw/master/packages/python/libpython3.11.so" || touch decoded_source/lib/arm64-v8a/libpython3.so

          # ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù€ Manifest Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© (Floating Window)
          sed -i '/<application/a \    <uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW"/>' decoded_source/AndroidManifest.xml
          
          echo "ğŸ—ï¸ Rebuilding Master Entity..."
          java -jar apktool.jar b decoded_source -o ./GEASS/final_apk/Geass_Cockpit_V2.apk

      - name: 5. SIGN_AND_DELIVER
        run: |
          keytool -genkey -v -keystore geass.jks -alias geass -keyalg RSA -keysize 2048 -validity 10000 -storepass 123456 -keypass 123456 -dname "CN=GEASS"
          apksigner sign --ks geass.jks --ks-pass pass:123456 --out ./GEASS/final_apk/Geass_Sovereign_V2_Final.apk ./GEASS/final_apk/Geass_Cockpit_V2.apk
          echo "âœ… Sovereign Cockpit Restored."

      - name: 6. UPLOAD
        uses: actions/upload-artifact@v4
        with:
          name: GEASS_COCKPIT_SYSTEM
          path: ./GEASS/final_apk/Geass_Sovereign_V2_Final.apk