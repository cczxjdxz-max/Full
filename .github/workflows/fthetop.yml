name: GIAS-THE-OVERSIGHT-EXTRACTOR
on:
  workflow_dispatch:

jobs:
  full_extraction:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Setup Environment
        run: pip install UnityPy

      - name: 2. Download & Unpack APK
        run: |
          wget -q -O game.apk "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
          unzip -o game.apk -d game_files

      - name: 3. The Master Mapper Script (Ø§Ù„Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„)
        run: |
          cat << 'EOF' > master_mapper.py
          import os
          import json
          import UnityPy

          target_dir = "game_files/assets/bin"
          full_inventory = {
              "Weapons_Logic": [],  # Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ø³Ù„Ø­Ø© ÙˆØ§Ù„Ø§Ø±ØªØ¯Ø§Ø¯
              "Maps_Bermuda": [],   # Ù…Ù„ÙØ§Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ§Ù„ØªØ¶Ø§Ø±ÙŠØ³
              "Characters_Physics": [], # Ø§Ù„Ù‡ÙŠØª Ø¨ÙˆÙƒØ³ ÙˆØ­Ø±ÙƒØ© Ø§Ù„Ø´Ø®ØµÙŠØ§Øª
              "Game_Rules": [],     # Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† ÙˆØ§Ù„Ø³Ø±Ø¹Ø© ÙˆØ§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©
              "Unidentified_Big_Files": [] # Ù…Ù„ÙØ§Øª Ø¶Ø®Ù…Ø© Ù‚Ø¯ ØªÙƒÙˆÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´ÙØ±Ø©
          }

          # Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ù„Ù„ØªØµÙ†ÙŠÙ
          categories = {
              "Weapons": [b"Weapon", b"Recoil", b"Bullet", b"Spread", b"Reload"],
              "Maps": [b"Bermuda", b"Terrain", b"StaticMesh", b"Environment"],
              "Physics": [b"Gravity", b"Hitbox", b"Collider", b"Ragdoll", b"Physics"],
              "Logic": [b"PlayerSkill", b"SpeedScale", b"Movement", b"Vehicle"]
          }

          print(f"ğŸ“¡ Scanning 40,000 files for complete game data...")

          for root, dirs, files in os.walk(target_dir):
              for file in files:
                  f_path = os.path.join(root, file)
                  f_size = os.path.getsize(f_path)
                  
                  if f_size < 5000: continue # ØªØ®Ø·ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹

                  try:
                      with open(f_path, 'rb') as f:
                          content = f.read()
                          
                          found = False
                          # ÙØ­Øµ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
                          for cat, keys in categories.items():
                              if any(k in content for k in keys):
                                  full_inventory[cat if cat != "Weapons" else "Weapons_Logic"].append({
                                      "file_id": file,
                                      "size": f_size,
                                      "matched_key": [k.decode() for k in keys if k in content][0]
                                  })
                                  found = True
                                  break
                          
                          if not found and f_size > 1000000: # Ù…Ù„ÙØ§Øª Ø¶Ø®Ù…Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©
                              full_inventory["Unidentified_Big_Files"].append({"file_id": file, "size": f_size})
                  except: continue

          with open("full_game_inventory.json", "w", encoding='utf-8') as f:
              json.dump(full_inventory, f, indent=4)
          
          print(f"âœ… Mission Success! Inventory created.")
          EOF
          python3 master_mapper.py

      - name: 4. Upload Complete Inventory
        uses: actions/upload-artifact@v4
        with:
          name: FULL_GAME_DATA_MAP
          path: full_game_inventory.json