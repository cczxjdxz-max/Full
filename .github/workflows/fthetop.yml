name: GEASS-IMAGE-AUDIT

on:
  workflow_dispatch:

jobs:
  visual_audit:
    runs-on: macos-latest # macOS Ø¶Ø±ÙˆØ±ÙŠ Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ ÙˆØ§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±
    steps:
      - name: 1. FETCH LATEST RELEASE
        uses: dsaltares/fetch-gh-release-asset@master
        with:
          version: 'latest'
          asset: 'Geass_Internal_Citadel.apk'
          target: './citadel_to_test.apk'
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: 2. VIRTUAL BOOT & SCREENSHOT
        uses: reactivecircus/android-emulator-runner@v2
        with:
          api-level: 29
          target: google_apis
          arch: x86_64
          force-avd-creation: true
          emulator-boot-timeout: 1000
          # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø®ÙÙØ© Ø¬Ø¯Ø§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ‚
          emulator-options: -no-window -gpu swiftshader_indirect -no-snapshot -noaudio -no-boot-anim -memory 3072
          script: |
            adb wait-for-device
            echo "ðŸš€ Device Ready. Installing APK..."
            adb install -r citadel_to_test.apk
            
            echo "â±ï¸ Launching Game..."
            adb shell monkey -p com.dts.freefireth -c android.intent.category.LAUNCHER 1
            
            echo "â³ Waiting 45 seconds for Splash Screen..."
            sleep 45
            
            echo "ðŸ“¸ Taking Screenshot..."
            adb shell screencap -p /sdcard/audit_frame.png
            adb pull /sdcard/audit_frame.png laboratory_result.png
            
            echo "ðŸ“œ Pulling Logcat Snippet..."
            adb logcat -d *:W > internal_logs.txt

      - name: 3. UPLOAD VISUAL EVIDENCE (Artifact)
        uses: actions/upload-artifact@v4
        with:
          name: CITADEL_VISUAL_REPORT
          path: |
            laboratory_result.png
            internal_logs.txt
