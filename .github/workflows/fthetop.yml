name: GEASS-ALL-OFFSETS-DUMPER-V2

on:
  workflow_dispatch:

jobs:
  dump_all:
    runs-on: ubuntu-latest
    steps:
      - name: 1. SETUP PYTHON ENVIRONMENT
        run: |
          pip install pyelftools
          # Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ø§Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†ØµÙˆØµ Ù‚ÙˆÙŠØ© Ù…Ø¯Ù…Ø¬Ø© ÙÙŠ Ø¨Ø§ÙŠØ«ÙˆÙ†
          
      - name: 2. GET YOUR APK
        run: |
          RELEASE_JSON=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" "https://api.github.com/repos/${{ github.repository }}/releases/latest")
          APK_URL=$(echo "$RELEASE_JSON" | grep -oP '"browser_download_url": "\K[^"]+\.apk(?=")' | head -1)
          curl -L -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" -H "Accept: application/octet-stream" "$APK_URL" -o master.apk

      - name: 3. EXTRACT TARGETS
        run: |
          unzip master.apk "lib/arm64-v8a/libil2cpp.so" "assets/bin/Data/Managed/Metadata/global-metadata.dat" -d ./extracted
          mv extracted/lib/arm64-v8a/libil2cpp.so ./libil2cpp.so
          mv extracted/assets/bin/Data/Managed/Metadata/global-metadata.dat ./global-metadata.dat

      - name: 4. THE MASTER SCANNER (Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø´Ø§Ù…Ù„)
        run: |
          cat << 'EOF' > scanner.py
          import re

          def extract_all_methods(so_path, metadata_path):
              print("ğŸ•µï¸ Starting Deep Memory Scan...")
              # Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…ÙŠØªØ§Ø¯Ø§ØªØ§ Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙƒÙ„ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¯ÙˆØ§Ù„
              with open(metadata_path, 'rb') as f:
                  data = f.read()
                  # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© (Get, Set, Update, Unlock)
                  methods = re.findall(b'[a-zA-Z0-9_]{5,50}', data)
                  
                  unique_methods = sorted(list(set(methods)))
                  with open("full_catalog.txt", "w") as out:
                      for m in unique_methods:
                          try:
                              decoded = m.decode()
                              if any(x in decoded for x in ["Skin", "Health", "Speed", "Weapon", "Aim", "Damage", "Inventory", "Unlock"]):
                                  out.write(f"ğŸ”± Found Method: {decoded}\n")
                          except:
                              continue
              print("âœ… Scan Complete. Catalog generated.")

          extract_all_methods("libil2cpp.so", "global-metadata.dat")
          EOF
          python3 scanner.py

      - name: 5. UPLOAD THE CATALOG
        uses: actions/upload-artifact@v4
        with:
          name: FULL_METHOD_CATALOG
          path: full_catalog.txt