# .github/workflows/geass-bundle-ripper.yml
name: GEASS-BUNDLE-RIPPER

on:
  workflow_dispatch:

jobs:
  rip_bundles:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Environment Setup
        run: |
          sudo apt-get update
          pip install UnityPy pillow 
          mkdir -p ./GEASS/extracted

      - name: 2. Download Game
        run: wget -q -O Game.apk "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"

      - name: 3. Smart Asset Extraction
        run: |
          cat << 'EOF' > rip_v2.py
          import UnityPy
          import os

          def extract():
              # تحميل الـ APK مع إجبار المكتبة على قراءة الـ Bundles
              env = UnityPy.load("Game.apk")
              count = 0
              
              # استهداف ملفات الـ Assets فقط التي تحتوي على صور
              for path, obj in env.container.items():
                  if obj.type.name in ["Texture2D", "Sprite"]:
                      data = obj.read()
                      try:
                          img = data.image
                          img.save(f"./GEASS/extracted/asset_{count}.png")
                          print(f"✅ Saved: {path}")
                          count += 1
                      except Exception as e:
                          continue
                  if count >= 10: break

              # إذا لم يجد في الحاويات، نبحث في الأشياء الخام (Raw Objects)
              if count == 0:
                  for obj in env.objects:
                      if obj.type.name in ["Texture2D", "Sprite"]:
                          data = obj.read()
                          try:
                              data.image.save(f"./GEASS/extracted/raw_{count}.png")
                              count += 1
                          except: continue
                      if count >= 10: break

          extract()
          EOF
          python3 rip_v2.py

      - name: 4. Upload Extracted Vision
        uses: actions/upload-artifact@v4
        with:
          name: GEASS_BUNDLE_VISION
          path: ./GEASS/extracted/