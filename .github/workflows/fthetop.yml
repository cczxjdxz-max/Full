name: GEASS-CITADEL-RELEASE-FORGE

on:
  workflow_dispatch: # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨

jobs:
  forge_and_release:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù€ GitHub Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ Release
    steps:
      - name: 1. SETUP TOOLS & ENVIRONMENT
        run: |
          sudo apt-get update
          sudo apt-get install -y openjdk-17-jdk wget zip unzip
          wget -q https://bitbucket.org/iBotPeaches/apktool/downloads/apktool_2.9.3.jar -o apktool.jar
          curl -L https://github.com/patrickfav/uber-apk-signer/releases/download/v1.3.0/uber-apk-signer-1.3.0.jar -o signer.jar
          echo "âœ… Forge tools are ready."

      - name: 2. THE SURGICAL PROCESS (Injection)
        run: |
          echo "ğŸ“¥ Downloading Base APK..."
          curl -L "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk" -o base.apk
          
          echo "ğŸ—ï¸ Decompiling..."
          java -jar apktool.jar d base.apk -o decoded
          
          echo "ğŸ’‰ Injecting Sovereign Core & Cockpit UI..."
          mkdir -p decoded/assets/python
          echo "import os; print('ğŸ”± Sovereign Internal Engine: ONLINE')" > decoded/assets/python/internal_master.py
          
          # Ø­Ù‚Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Ù†Ø¸Ø§Ù… Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ ÙŠØ­ØªØ§Ø¬ SYSTEM_ALERT_WINDOW Ù„Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø©)
          sed -i '/<application/i <uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW"/>' decoded/AndroidManifest.xml

          echo "ğŸ—ï¸ Rebuilding & Signing..."
          java -jar apktool.jar b decoded -o Unsigned.apk
          java -jar signer.jar --apks Unsigned.apk --out ./
          mv Unsigned-aligned-debugSigned.apk Geass_Internal_Citadel.apk

      - name: 3. INTEGRITY VERIFICATION
        run: |
          echo "ğŸ” Verifying Build Quality..."
          unzip -l Geass_Internal_Citadel.apk | grep "internal_master.py" && echo "âœ… Python Core: FOUND"
          java -jar signer.jar --verify --apks Geass_Internal_Citadel.apk && echo "âœ… Signature: VALID"

      - name: 4. CREATE OFFICIAL GITHUB RELEASE
        uses: softprops/action-gh-release@v2
        with:
          tag_name: "v${{ github.run_number }}"
          name: "Geass Citadel Build #${{ github.run_number }}"
          body: |
            ğŸ”± **Geass Citadel Master Build**
            ---
            - **Status:** Structural Integrity Verified âœ…
            - **Python Core:** Sovereign Engine v1.0
            - **Injections:** System Overlay & Internal API
            - **Timestamp:** ${{ github.event.repository.updated_at }}
          files: Geass_Internal_Citadel.apk
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: 5. NOTIFY SUCCESS
        run: |
          echo "ğŸš€ Release is LIVE! You can download it from the Releases tab."