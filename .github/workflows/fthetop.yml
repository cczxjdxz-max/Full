name: GEASS-DEEP-REVERSE

on:
  workflow_dispatch:

jobs:
  deep_search:
    runs-on: ubuntu-latest
    steps:
      - name: 1. PREPARE SCANNER
        run: pip install pyelftools

      - name: 2. FETCH APK & EXTRACT
        run: |
          RELEASE_JSON=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" "https://api.github.com/repos/${{ github.repository }}/releases/latest")
          APK_URL=$(echo "$RELEASE_JSON" | grep -oP '"browser_download_url": "\K[^"]+\.apk(?=")' | head -1)
          curl -L -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" -H "Accept: application/octet-stream" "$APK_URL" -o game.apk
          unzip game.apk "lib/arm64-v8a/libil2cpp.so" "assets/bin/Data/Managed/Metadata/global-metadata.dat" -d ./

      - name: 3. GEASS DEEP ANALYSIS (Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ‚)
        run: |
          cat << 'EOF' > deep_analyzer.py
          import struct

          def find_offsets():
              print("ðŸ•µï¸ Analyzing Game Brain...")
              # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙˆØ§Ù„Ø³ÙƒÙ†Ø§Øª
              # Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ù„Ù„Ø³ÙŠØ·Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
              keywords = ["GetItem", "Skin", "Event", "Inventory", "Unlock", "Equip"]
              
              with open("assets/bin/Data/Managed/Metadata/global-metadata.dat", "rb") as f:
                  data = f.read()
                  for word in keywords:
                      pos = data.find(word.encode())
                      if pos != -1:
                          print(f"ðŸ”± Found Critical Point: {word} at Hex {hex(pos)}")

          find_offsets()
          EOF
          python3 deep_analyzer.py > deep_report.txt

      - name: 4. UPLOAD RESULTS
        uses: actions/upload-artifact@v4
        with:
          name: DEEP_REVERSE_REPORT
          path: deep_report.txt