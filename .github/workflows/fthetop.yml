name: GIAS-CLOUD-BRAIN-BUILDER
on:
  workflow_dispatch:

jobs:
  cloud_build:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Setup Virtual Environment
        run: pip install UnityPy

      - name: 2. Fetch & Dissect (سحب وتفكيك سحابي)
        run: |
          wget -q -O game.apk "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
          unzip -o game.apk -d game_files

      - name: 3. The Grand Aggregator (المجمع الذكي)
        run: |
          cat << 'EOF' > cloud_aggregator.py
          import UnityPy
          import os
          import json

          # الحاويات الموحدة لبيئة الـ IQ 250
          master_data = {
              "BERMUDA_MAP": 0, "WEAPONS_PHYSICS": 0, "CHARACTERS": 0, "GLOBAL_RULES": 0
          }
          
          # سيتم حفظ الخلاصة فقط لتقليل الحجم
          summary_report = {}

          for root, dirs, files in os.walk("game_files"):
              for file in files:
                  try:
                      env = UnityPy.load(os.path.join(root, file))
                      for obj in env.objects:
                          # تحليل المحتوى دون الحاجة لحفظه يدوياً على جهازك
                          raw_size = len(obj.get_raw_data())
                          if raw_size > 10:
                              name = obj.type.name
                              summary_report[name] = summary_report.get(name, 0) + 1
                  except: continue

          with open("CLOUD_SUMMARY.json", "w") as f:
              json.dump(summary_report, f, indent=4)
          EOF
          python3 cloud_aggregator.py

      - name: 4. Export Small Summary Only
        uses: actions/upload-artifact@v4
        with:
          name: AI_KNOWLEDGE_SUMMARY
          path: CLOUD_SUMMARY.json