name: GIAS-GIANT-ASSET-HUNTER
on:
  workflow_dispatch:
  push:
    paths: ['geass2.yml']

jobs:
  hunt_giants:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Setup Environment
        run: |
          pip install UnityPy
          sudo apt-get install -y p7zip-full

      - name: 2. Download & Preparation
        run: |
          wget -q -O game.apk "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
          unzip -o game.apk -d game_files
          echo "âœ… APK extracted. Locating bin folder..."

      - name: 3. Giant Hunting Script (Size-Based)
        run: |
          cat << 'EOF' > hunter.py
          import UnityPy
          import json
          import os

          found_gems = []
          target_dir = ""

          # Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù† Ù…Ø¬Ù„Ø¯ bin
          for root, dirs, files in os.walk("game_files"):
              if root.endswith("bin"):
                  target_dir = root
                  break

          if not target_dir:
              print("âŒ Error: 'bin' folder not found!")
              exit(1)

          print(f"ğŸ“¡ Hunting giants in {target_dir}...")

          for root, dirs, files in os.walk(target_dir):
              for file in files:
                  file_path = os.path.join(root, file)
                  
                  # Ø³Ù†Ø±ÙƒØ² ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙŠ ØªØ²ÙŠØ¯ Ø¹Ù† 500 ÙƒÙŠÙ„Ùˆ Ø¨Ø§ÙŠØª
                  # Ù„Ø£Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ§Ù„ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ø³ØªØ­ÙŠÙ„ ØªÙƒÙˆÙ† Ø£ØµØºØ± Ù…Ù† Ø°Ù„Ùƒ
                  if os.path.getsize(file_path) < 512000: 
                      continue
                      
                  try:
                      env = UnityPy.load(file_path)
                      for obj in env.objects:
                          # Mesh = Ø®Ø±Ø§Ø¦Ø· ÙˆØªØ¶Ø§Ø±ÙŠØ³
                          # MonoBehaviour = ÙÙŠØ²ÙŠØ§Ø¡ ÙˆÙ‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
                          if obj.type.name in ["Mesh", "MonoBehaviour", "TextAsset"]:
                              found_gems.append({
                                  "encrypted_file": file,
                                  "type": obj.type.name,
                                  "data_size": obj.size,
                                  "path_id": obj.path_id
                              })
                  except:
                      continue

          # ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ù† Ø§Ù„Ø£Ø¶Ø®Ù… (Ø§Ù„Ø£ÙƒØ«Ø± Ø£Ù‡Ù…ÙŠØ©) Ø¥Ù„Ù‰ Ø§Ù„Ø£ØµØºØ±
          found_gems.sort(key=lambda x: x['data_size'], reverse=True)

          # Ø­ÙØ¸ Ø£ÙƒØ¨Ø± 50 ÙƒØ§Ø¦Ù† Ù…ÙƒØªØ´Ù
          with open("top_giants.json", "w", encoding='utf-8') as f:
              json.dump(found_gems[:50], f, indent=4)

          print(f"âœ… Success! Captured {len(found_gems)} giant objects.")
          EOF
          python3 hunter.py

      - name: 4. Final Logs & Artifacts
        run: |
          echo "--- TOP 10 LARGEST DATA OBJECTS FOUND ---"
          head -n 50 top_giants.json
          
      - name: ğŸ“¦ Upload Captured Data
        uses: actions/upload-artifact@v4
        with:
          name: CAPTURED_GIANT_ASSETS
          path: top_giants.json