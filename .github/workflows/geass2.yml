name: GIAS-DEEP-DATA-EXTRACTOR
on:
  workflow_dispatch:
  push:
    paths: ['geass2.yml']

jobs:
  extract:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Setup Tools
        run: |
          pip install UnityPy numpy
          sudo apt-get install -y p7zip-full

      - name: 2. Download & Unzip All Layers
        run: |
          wget -q -O game.apk "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
          unzip -o game.apk -d game_files
          # ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ù„ÙØ§Øª OBB Ù…Ø¯Ù…Ø¬Ø© Ø£Ùˆ Ù…Ù„ÙØ§Øª AssetBin
          find game_files -name "*.zip" -exec unzip -o {} -d game_files \;

      - name: 3. Deep Mining Script (The Engine)
        run: |
          cat << 'EOF' > miner.py
          import UnityPy
          import json
          import os

          # ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
          results = {
              "Bermuda_Map": [],
              "Physics_Rules": [],
              "Characters_Data": [],
              "Weapons_Gernades": [],
              "Gloo_Resources": []
          }

          def start_mining():
              print("ğŸš€ Starting Deep Scan...")
              for root, dirs, files in os.walk("game_files"):
                  for file in files:
                      # ÙØ­Øµ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¶Ø®Ù…Ø© Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª
                      if file.endswith(('.assets', '.sharedassets', '.bundle', '.data')) or "level" in file:
                          try:
                              env = UnityPy.load(os.path.join(root, file))
                              for obj in env.objects:
                                  # Ù†Ø­Ù† Ù†Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ© ÙˆØªØ­ÙˆÙŠÙ„Ø§Øª
                                  if obj.type.name in ["MonoBehaviour", "Transform", "GameObject", "Mesh"]:
                                      data = obj.read()
                                      name = getattr(data, 'name', 'Unnamed_Object').lower()
                                      
                                      # Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø¯Ù‚ÙŠÙ‚
                                      info = {"n": name, "t": obj.type.name, "id": obj.path_id}
                                      
                                      if "bermuda" in name or "terrain" in name:
                                          results["Bermuda_Map"].append(info)
                                      elif "physic" in name or "gravity" in name or "velocity" in name:
                                          results["Physics_Rules"].append(info)
                                      elif "char" in name or "hero" in name or "skin" in name:
                                          results["Characters_Data"].append(info)
                                      elif "weapon" in name or "gun" in name or "grenade" in name:
                                          results["Weapons_Gernades"].append(info)
                                      elif "gloo" in name or "wall" in name:
                                          results["Gloo_Resources"].append(info)
                          except:
                              continue

              with open("precision_game_data.json", "w", encoding='utf-8') as f:
                  json.dump(results, f, indent=2)
              
              size = os.path.getsize("precision_game_data.json")
              print(f"âœ… Mining Complete! Data Size: {size / 1024:.2f} KB")

          if __name__ == "__main__":
              start_mining()
          EOF
          python3 miner.py

      - name: 4. Upload Precision Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: FULL_PRECISION_DATA
          path: precision_game_data.json