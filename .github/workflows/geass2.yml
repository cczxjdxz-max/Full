name: GIAS-XOR-DECODDDER-SCAN
on:
  workflow_dispatch:

jobs:
  decryption_test:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Setup
        run: pip install UnityPy

      - name: 2. APK Unpacking
        run: |
          wget -q -O game.apk "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
          unzip -o game.apk -d game_files

      - name: 3. XOR Brute-Force & Signature Scanner
        run: |
          cat << 'EOF' > xor_detector.py
          import os
          import UnityPy

          target_dir = "game_files/assets/bin"
          results = []

          print(f"ğŸ•µï¸ Starting XOR detection on 30k files in {target_dir}...")

          # Ù†Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø£ÙˆÙ„ 100 Ù…Ù„Ù Ø¶Ø®Ù… ÙƒØ¹ÙŠÙ†Ø© ÙØ­Øµ
          files_to_scan = [os.path.join(root, f) for root, dirs, files in os.walk(target_dir) for f in files if os.path.getsize(os.path.join(root, f)) > 500000][:100]

          for f_path in files_to_scan:
              with open(f_path, 'rb') as f:
                  raw_data = f.read(100)
                  
                  # 1. ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
                  if b"Unity" in raw_data:
                      results.append({"file": os.path.basename(f_path), "status": "Clean UnityFS"})
                      continue
                  
                  # 2. ØªØ¬Ø±Ø¨Ø© ÙÙƒ ØªØ´ÙÙŠØ± XOR Ø¨Ø³ÙŠØ· (Common in Games)
                  # Ø³Ù†Ø¬Ø±Ø¨ Ù…ÙØ§ØªÙŠØ­ Ù…Ø´Ù‡ÙˆØ±Ø© Ø£Ùˆ Ø§Ø³ØªÙ†ØªØ§Ø¬ Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ù† Ø£ÙˆÙ„ Ø¨Ø§ÙŠØª
                  # Ø¨ØµÙ…Ø© Unity ØªØ¨Ø¯Ø£ Ø¨Ù€ 'U' (0x55)
                  xor_key = raw_data[0] ^ 0x55 
                  decrypted_head = bytes([b ^ xor_key for b in raw_data])
                  
                  if b"Unity" in decrypted_head:
                      results.append({
                          "file": os.path.basename(f_path),
                          "status": "XOR Encrypted",
                          "key": hex(xor_key)
                      })

          if not results:
              print("âŒ No Unity signatures found even with XOR test.")
          else:
              for r in results:
                  print(f"âœ… Found: {r}")

          import json
          with open("xor_results.json", "w") as f:
              json.dump(results, f, indent=4)
          EOF
          python3 xor_detector.py

      - name: 4. Final Logs
        run: |
          echo "--- DETECTION RESULTS ---"
          cat xor_results.json