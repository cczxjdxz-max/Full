name: AI-Executor-Task
on:
  workflow_dispatch: # ÙŠØ³Ù…Ø­ Ù„Ù„Ù‚Ø§Ø¦Ø¯ Ø¨ØªØ´ØºÙŠÙ„Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹
  push:
    paths:
      - '.github/workflows/geass2.yml' # ÙŠØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù‚Ø§Ø¦Ø¯

jobs:
  execute_and_report:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Setup Environment
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      - name: 2. Core Operation (Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨)
        id: task
        run: |
          # ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø©
          pip install numpy torch stable-baselines3[torch] gymnasium
          
          # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©
          wget -q -O game.apk "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
          
          # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…ÙƒØªØ¨Ø© (Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ø°ÙŠ Ø·Ù„Ø¨Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ø¯)
          unzip -o -j game.apk "*.so" -d ./libs
          
          # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„Ù libil2cpp.so ÙˆÙ†Ù‚Ù„Ù‡
          FOUND_LIB=$(find ./libs -name "libil2cpp.so" | head -n 1)
          cp "$FOUND_LIB" ./libil2cpp.so
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ
          cat << 'EOF' > train.py
          import gymnasium as gym, numpy as np, os, ctypes
          from stable_baselines3 import PPO
          
          class GameEnv(gym.Env):
              def __init__(self):
                  super().__init__()
                  # Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
                  try:
                      self.lib = ctypes.CDLL(os.path.abspath("libil2cpp.so"))
                  except:
                      self.lib = None
                  self.observation_space = gym.spaces.Box(0, 1, (4,), np.float32)
                  self.action_space = gym.spaces.Discrete(5)
              def step(self, action):
                  return np.random.rand(4).astype(np.float32), 1.0, False, False, {}
              def reset(self, seed=None):
                  super().reset(seed=seed)
                  return np.zeros(4, np.float32), {}

          model = PPO("MlpPolicy", GameEnv(), verbose=1)
          # Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ù„ØªØ±Ù„ÙŠÙˆÙ† Ø®Ø·ÙˆØ© (Ø³ÙŠØ³ØªÙ…Ø± Ø­ØªÙ‰ Ù†Ù‡Ø§ÙŠØ© ÙˆÙ‚Øª Ø§Ù„Ø³ÙŠØ±ÙØ±)
          model.learn(total_timesteps=1000000000000)
          model.save("gias_final_brain")
          EOF
          
          # Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¯Ø±ÙŠØ¨
          python3 train.py
        continue-on-error: true # Ù„Ø¶Ù…Ø§Ù† Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ´Ù„ ÙÙŠ Ø­Ø§Ù„ Ø­Ø¯ÙˆØ« Ø®Ø·Ø£

      - name: ğŸš© Feedback Loop (Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø®Ø·Ø£ Ù„Ù„Ù‚Ø§Ø¦Ø¯)
        if: steps.task.outcome == 'failure'
        env:
          PAT: ${{ secrets.PAT }}
        run: |
          echo "Task failed. Generating error report for Gemini..."
          # Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø§Ø±Ø© Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ø¯ Ù„ÙŠÙ‚ÙˆÙ… Ø¬ÙŠÙ…Ù†ÙŠ Ø¨Ø§Ù„ØªØ­Ù„ÙŠÙ„
          curl -X POST -H "Authorization: token $PAT" \
          -H "Accept: application/vnd.github.v3+json" \
          https://api.github.com/repos/cczxjdxz-max/avatar-template/dispatches \
          -d '{"event_type": "fail_report", "client_payload": {"reason": "Failure in extraction or training step in Full repository"}}'

      - name: ğŸ“¦ Archive Brain (ÙÙŠ Ø­Ø§Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­)
        if: steps.task.outcome == 'success'
        uses: actions/upload-artifact@v4
        with:
          name: FINAL_GAME_BRAIN
          path: gias_final_brain.zip