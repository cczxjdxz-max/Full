name: Ultimate Full Library Scanner 2026

on:
  workflow_dispatch:

jobs:
  deep_scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Run Deep Offset Scanner
        shell: python
        run: |
          import os
          import glob

          # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ Ù…Ù„Ù ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ù€ .so Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
          so_files = glob.glob("**/*.so", recursive=True)
          
          if not so_files:
              print("âŒ Error: No .so files found in the repository!")
              # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù ÙØ§Ø±Øº Ù„Ù…Ù†Ø¹ ØªØ¹Ø·Ù„ Ø§Ù„Ø£ÙƒØ´Ù† ØªÙ…Ø§Ù…Ø§Ù‹ ÙˆØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø®Ø·Ø£
              with open("Complete_Offsets_List.txt", "w") as f:
                  f.write("Error: libil2cpp.so file was not found in the repository.")
              exit(0)

          target_file = so_files[0]
          print(f"âœ… Found file: {target_file}")
          
          output_file = "Complete_Offsets_List.txt"
          offsets = []
          patterns = [b'\xFD\x7B\xBF\xA9', b'\xFF\x43\x00\xD1', b'\xFD\x7B\xBA\xA9']
          
          print(f"ğŸ” Scanning {target_file}...")
          
          with open(target_file, "rb") as f:
              data = f.read()
              for pattern in patterns:
                  current_pos = 0
                  while True:
                      current_pos = data.find(pattern, current_pos)
                      if current_pos == -1: break
                      offsets.append(current_pos)
                      current_pos += 4
          
          unique_offsets = sorted(list(set(offsets)))
          
          with open(output_file, "w") as out:
              out.write(f"--- FULL MEMORY SCAN REPORT ---\n")
              out.write(f"Source File: {target_file}\n")
              out.write(f"Total Functions Found: {len(unique_offsets)}\n\n")
              for addr in unique_offsets:
                  out.write(f"{hex(addr)}\n")
          
          print(f"âœ… Extracted {len(unique_offsets)} offsets.")

      - name: Verify and Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Full-Library-Dump-2026
          path: Complete_Offsets_List.txt
          retention-days: 5