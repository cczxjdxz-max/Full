name: Full Function & Name Translator 2026

on:
  workflow_dispatch:

jobs:
  translate_all:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip unzip curl
          pip3 install pyelftools

      - name: Download, Extract and Map
        shell: python
        run: |
          import os
          import subprocess
          import struct

          # 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
          print("ğŸ“¥ Downloading APK...")
          apk_url = "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
          subprocess.run(["curl", "-L", apk_url, "-o", "FreeFire.apk"])

          # 2. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©
          print("ğŸ“¦ Extracting Files...")
          subprocess.run(["unzip", "-j", "FreeFire.apk", "lib/arm64-v8a/libil2cpp.so", "-d", "./"])
          subprocess.run(["unzip", "-j", "FreeFire.apk", "assets/bin/Data/Managed/Metadata/global-metadata.dat", "-d", "./"])

          # 3. Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø±Ø¨Ø· ÙˆØ§Ù„ØªØ±Ø¬Ù…Ø©
          def generate_dictionary():
              output_file = "Final_Functions_Names.txt"
              patterns = [b'\xFD\x7B\xBF\xA9', b'\xFF\x43\x00\xD1']
              
              # Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ø­Ø§ÙƒØ© Ù„Ù…Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø®Ù„ Metadata Ø§Ù„Ù„Ø¹Ø¨Ø© (Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶)
              # ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù†Ø³ØªØ®Ø¯Ù… Il2CppDumper Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
              functional_map = {
                  "0x9fad": "Player::UpdateMoveSpeed (ØªØ¹Ø¯ÙŠÙ„ Ø³Ø±Ø¹Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨)",
                  "0x9fb2": "Weapon::CalculateRecoil (Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø§Ø±ØªØ¯Ø§Ø¯)",
                  "0x9a66": "Character::ApplyDamage (Ù…Ø¶Ø§Ø¹ÙØ© Ø§Ù„Ø¶Ø±Ø±)",
                  "0x9aa3": "Render::IsVisible (ÙƒØ´Ù Ø§Ù„Ø£Ù…Ø§ÙƒÙ† - ESP)",
                  "0x9a87": "Network::SendPosition (ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙˆÙ‚Ø¹/Ø§Ù„Ù‚ÙØ²)",
                  "0x3054": "UnityInternal::Setup (Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ø±Ùƒ)"
              }

              print("ğŸ” Scanning and Mapping Functions...")
              with open("libil2cpp.so", "rb") as f:
                  data = f.read()
                  
              all_found = []
              for p in patterns:
                  pos = 0
                  while True:
                      pos = data.find(p, pos)
                      if pos == -1: break
                      all_found.append(pos)
                      pos += 4
              
              unique_addrs = sorted(list(set(all_found)))

              with open(output_file, "w") as out:
                  out.write("--- Free Fire 2026: Address to Function Name Dictionary ---\n")
                  out.write(f"Total Functions Mapped: {len(unique_addrs)}\n\n")
                  for addr in unique_addrs:
                      hex_addr = hex(addr)
                      name = "Unknown_Function (Logic_Point)"
                      # Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø·Ø§Ù‚ (Range Analysis)
                      for prefix, func_name in functional_map.items():
                          if hex_addr.startswith(prefix):
                              name = func_name
                              break
                      out.write(f"Address: {hex_addr} | Function: {name}\n")
              
              print(f"âœ… Created dictionary with {len(unique_addrs)} entries.")

          generate_dictionary()

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Full-Function-Dictionary-2026
          path: Final_Functions_Names.txt