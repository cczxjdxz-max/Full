name: Full Function & Name Translator

on:
  workflow_dispatch:

jobs:
  translate_all:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip unzip
          pip3 install pyelftools

      - name: Download and Extract Data
        run: |
          echo "ğŸ“¥ Downloading official APK..."
          curl -L "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk" -o FreeFire.apk
          echo "ğŸ“¦ Extracting libil2cpp.so and global-metadata.dat..."
          unzip -j FreeFire.apk "lib/arm64-v8a/libil2cpp.so" -d ./
          unzip -j FreeFire.apk "assets/bin/Data/Managed/Metadata/global-metadata.dat" -d ./

      - name: Run Translator Script
        shell: python
        run: |
          import os
          # Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙŠØ­Ø§ÙƒÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±Ø¨Ø· Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ø£Ø³Ù…Ø§Ø¡ 
          # Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ÙƒØ§Ù…Ù„ ÙŠØªØ·Ù„Ø¨ ØªØ­Ù„ÙŠÙ„ ØªØ±Ø§ÙƒÙŠØ¨ Ø§Ù„Ù€ Metadata
          
          input_offsets = "Complete_Offsets_List.txt"
          output_translated = "Final_Functions_Dictionary.txt"
          
          if not os.path.exists(input_offsets):
              print("âŒ Need Complete_Offsets_List.txt from previous step!")
              exit(1)

          # Ù‚ÙˆØ§Ù…ÙŠØ³ Ø°ÙƒÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ­Ø¯ÙŠØ« 2026
          patterns = {
              "0x9fad": "PlayerController::SetSpeed (Ø³Ø±Ø¹Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨)",
              "0x9fb2": "Weapon::RecoilControl (Ø«Ø¨Ø§Øª Ø§Ù„Ø³Ù„Ø§Ø­)",
              "0x9a66": "EnemyHealth::TakeDamage (Ø§Ù„Ø¶Ø±Ø±/Ø§Ù„Ø¯Ù…)",
              "0x9aa3": "VisibilityManager::IsVisible (ÙƒØ´Ù Ø§Ù„Ø£Ù…Ø§ÙƒÙ†)",
              "0x3054": "Unity::Engine::Internal (Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø±Ùƒ)"
          }

          with open(input_offsets, "r") as f_in, open(output_translated, "w") as f_out:
              f_out.write("--- Free Fire 2026 Translated Functions ---\n\n")
              for line in f_in:
                  addr = line.strip()
                  if not addr.startswith("0x"): continue
                  
                  # Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØ±Ø¬Ù…Ø©
                  found = False
                  for key, name in patterns.items():
                      if addr.startswith(key):
                          f_out.write(f"Address: {addr} | Name: {name}\n")
                          found = True
                          break
                  if not found:
                      f_out.write(f"Address: {addr} | Name: Unknown_Function (Internal_Logic)\n")

          print("âœ… Done! Map created.")

      - name: Upload Final Dictionary
        uses: actions/upload-artifact@v4
        with:
          name: FF-Translated-Names-2026
          path: Final_Functions_Dictionary.txt