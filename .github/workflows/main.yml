name: Auto APK Downloader & Scanner

on:
  workflow_dispatch: # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ

jobs:
  download_and_scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Download Free Fire APK
        run: |
          echo "ğŸ“¥ Downloading APK from official CDN..."
          curl -L "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk" -o FreeFire.apk
          echo "âœ… Download complete."

      - name: Extract libil2cpp.so
        run: |
          echo "ğŸ“¦ Extracting libil2cpp.so from APK..."
          # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„Ù Ø§Ù„Ù€ arm64 ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬Ù‡
          unzip -j FreeFire.apk "lib/arm64-v8a/libil2cpp.so" -d ./ || unzip -j FreeFire.apk "lib/armeabi-v7a/libil2cpp.so" -d ./
          
          if [ -f "libil2cpp.so" ]; then
            echo "âœ… Library extracted successfully."
            ls -lh libil2cpp.so
          else
            echo "âŒ Error: Could not find libil2cpp.so inside the APK!"
            exit 1
          fi

      - name: Deep Offset Scanner (Python)
        shell: python
        run: |
          import os
          
          target_file = "libil2cpp.so"
          output_file = "Complete_Offsets_List.txt"
          
          if not os.path.exists(target_file):
              print("âŒ File not found for scanning!")
              exit(1)

          offsets = []
          # Ø£Ù†Ù…Ø§Ø· ARM64 Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¯ÙˆØ§Ù„
          patterns = [b'\xFD\x7B\xBF\xA9', b'\xFF\x43\x00\xD1', b'\xFD\x7B\xBA\xA9']
          
          print(f"ğŸ” Scanning {target_file} for all potential functions...")
          
          with open(target_file, "rb") as f:
              data = f.read()
              for pattern in patterns:
                  pos = 0
                  while True:
                      pos = data.find(pattern, pos)
                      if pos == -1: break
                      offsets.append(pos)
                      pos += 4
          
          unique_offsets = sorted(list(set(offsets)))
          
          with open(output_file, "w") as out:
              out.write(f"--- FREE FIRE 2026 FULL DUMP ---\n")
              out.write(f"Source: Official APK Link\n")
              out.write(f"Total Unique Offsets: {len(unique_offsets)}\n")
              out.write("-" * 40 + "\n\n")
              for addr in unique_offsets:
                  out.write(f"{hex(addr)}\n")
          
          print(f"âœ… Extracted {len(unique_offsets)} offsets.")

      - name: Upload Translation Report
        uses: actions/upload-artifact@v4
        with:
          name: FF-Full-Offsets-2026
          path: Complete_Offsets_List.txt
          retention-days: 5