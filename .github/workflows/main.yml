name: Global IL2CPP Dumper 2026

on:
  workflow_dispatch:

jobs:
  full_dump:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Dotnet (Required for Dumper)
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '6.x'

      - name: Download Files and Dumper
        run: |
          # تحميل اللعبة
          curl -L "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk" -o FreeFire.apk
          unzip -j FreeFire.apk "lib/arm64-v8a/libil2cpp.so" -d ./
          unzip -j FreeFire.apk "assets/bin/Data/Managed/Metadata/global-metadata.dat" -d ./
          
          # تحميل أداة Il2CppDumper (نسخة CLI لـ Linux)
          curl -L "https://github.com/Perfare/Il2CppDumper/releases/download/v6.7.40/Il2CppDumper-v6.7.40.zip" -o dumper.zip
          unzip dumper.zip -d dumper_tool

      - name: Execute Dump
        run: |
          # تشغيل الـ Dumper لربط العناوين بالأسماء
          # سنستخدم Python لتمرير المدخلات للأداة
          echo -e "./libil2cpp.so\n./global-metadata.dat" | dotnet ./dumper_tool/Il2CppDumper.dll
          
      - name: Format and Translate Output
        shell: python
        run: |
          # تنظيف الملف الناتج وترجمته ليكون سهل القراءة
          import re
          
          with open("DummyDll/dump.cs", "r") as f:
              content = f.read()
              
          # استخراج العناوين والأسماء فقط
          matches = re.findall(r"// RVA: (0x[0-9A-F]+).*?\n\s+(.*?)\(.*?\)", content, re.MULTILINE)
          
          with open("Every_Single_Function_2026.txt", "w") as out:
              out.write("--- FREE FIRE 2026 COMPLETE DICTIONARY ---\n\n")
              for rva, name in matches:
                  # ترجمة مبسطة لبعض الكلمات المفتاحية
                  desc = ""
                  if "Speed" in name: desc = " (سرعة)"
                  elif "Damage" in name: desc = " (ضرر)"
                  elif "Jump" in name: desc = " (قفز)"
                  elif "Recoil" in name: desc = " (ارتداد)"
                  elif "Aim" in name: desc = " (تصويب)"
                  
                  out.write(f"Offset: {rva} | Function: {name}{desc}\n")

      - name: Upload Everything
        uses: actions/upload-artifact@v4
        with:
          name: Full-Game-Functions-2026
          path: Every_Single_Function_2026.txt