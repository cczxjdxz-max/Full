name: Ultimate Full Library Scanner

on:
  workflow_dispatch: # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨

jobs:
  deep_scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Run Deep Offset Scanner
        shell: python
        run: |
          import os
          import struct

          def extract_all_offsets(file_path):
              if not os.path.exists(file_path):
                  print(f"âŒ Error: {file_path} not found!")
                  return

              offsets = []
              # Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ ÙÙŠ ARM64 (STP X29, X30, [SP, #...]!)
              # ÙˆÙ‡Ù†Ø§Ùƒ Ø£Ù†Ù…Ø§Ø· Ø£Ø®Ø±Ù‰ Ù…Ø«Ù„ (SUB SP, SP, #...)
              patterns = [b'\xFD\x7B\xBF\xA9', b'\xFF\x43\x00\xD1', b'\xFD\x7B\xBA\xA9']
              
              print("ğŸ” Scanning for all function signatures...")
              
              with open(file_path, "rb") as f:
                  data = f.read()
                  for pattern in patterns:
                      current_pos = 0
                      while True:
                          current_pos = data.find(pattern, current_pos)
                          if current_pos == -1: break
                          offsets.append(current_pos)
                          current_pos += 4
              
              # Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…ÙƒØ±Ø±Ø© ÙˆØªØ±ØªÙŠØ¨Ù‡Ø§
              unique_offsets = sorted(list(set(offsets)))
              
              with open("Complete_Offsets_List.txt", "w") as out:
                  out.write(f"--- FULL MEMORY SCAN REPORT ---\n")
                  out.write(f"Target: {file_path}\n")
                  out.write(f"Total Unique Addresses Found: {len(unique_offsets)}\n")
                  out.write("-" * 35 + "\n\n")
                  for addr in unique_offsets:
                      out.write(f"{hex(addr)}\n")
              
              print(f"âœ… Success! Found {len(unique_offsets)} functions.")

          # ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù ÙŠØ·Ø§Ø¨Ù‚ Ù…Ù„ÙÙƒ
          extract_all_offsets("libil2cpp.so")

      - name: Upload Full Results
        uses: actions/upload-artifact@v4
        with:
          name: Full-Library-Dump-2026
          path: Complete_Offsets_List.txt
          retention-days: 5