name: Ultimate Full Library Scanner 2026

on:
  workflow_dispatch: # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ

jobs:
  deep_scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Run Deep Offset Scanner
        shell: python
        run: |
          import os
          import struct

          # Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù (ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ù„Ù Ù…Ø±ÙÙˆØ¹ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù…)
          target_file = "libil2cpp.so"
          output_file = "Complete_Offsets_List.txt"

          def extract_all_offsets(file_path):
              if not os.path.exists(file_path):
                  print(f"âŒ Error: {file_path} not found in workspace!")
                  return False

              offsets = []
              # Ø£Ù†Ù…Ø§Ø· ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„Ø¯ÙˆØ§Ù„ ÙÙŠ ARM64
              # 1. STP X29, X30, [SP, #...]!
              # 2. SUB SP, SP, #...
              patterns = [b'\xFD\x7B\xBF\xA9', b'\xFF\x43\x00\xD1', b'\xFD\x7B\xBA\xA9']
              
              print(f"ğŸ” Scanning {file_path} for function signatures...")
              
              with open(file_path, "rb") as f:
                  data = f.read()
                  for pattern in patterns:
                      current_pos = 0
                      while True:
                          current_pos = data.find(pattern, current_pos)
                          if current_pos == -1: break
                          offsets.append(current_pos)
                          current_pos += 4
              
              # ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ­Ø°Ù Ø§Ù„Ù…ÙƒØ±Ø±
              unique_offsets = sorted(list(set(offsets)))
              
              with open(output_file, "w") as out:
                  out.write(f"--- FULL MEMORY SCAN REPORT (Free Fire 2026) ---\n")
                  out.write(f"Total Unique Addresses Found: {len(unique_offsets)}\n")
                  out.write("-" * 45 + "\n\n")
                  for addr in unique_offsets:
                      out.write(f"{hex(addr)}\n")
              
              print(f"âœ… Success! Found {len(unique_offsets)} functions and saved to {output_file}")
              return True

          extract_all_offsets(target_file)

      - name: Verify and Upload Artifact
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: Full-Library-Dump-2026
          path: Complete_Offsets_List.txt
          if-no-files-found: error # Ø³ÙŠÙØ´Ù„ Ø§Ù„Ø£ÙƒØ´Ù† Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù
          retention-days: 5