name: 11. GitHub as AI Client - Dynamic Design Build
on:
  workflow_dispatch: # Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© GitHub Actions

permissions:
  contents: write # Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù APK ÙˆØ¥ØµØ¯Ø§Ø±Ù‡

jobs:
  build_with_ai_generated_assets:
    runs-on: ubuntu-latest # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¹Ù„Ù‰ Ø®Ø§Ø¯Ù… Ubuntu
    steps:
      - name: ğŸ“‚ Checkout Repository
        uses: actions/checkout@v4 # Ø¬Ù„Ø¨ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹

      - name: â˜• Setup Java 11
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '11' # Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ¦Ø© Java Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ø¨Ù†Ø§Ø¡ Android

      - name: ğŸ§  Request Design from Gemini 1.5 Flash (AI is the Designer)
        id: get_ai_design
        run: |
          # Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Curl Ø¥Ù„Ù‰ Gemini API Ù„Ø¬Ù„Ø¨ ÙƒÙˆØ¯ Vector Drawable Ù„Ø¹ÙŠÙ† Ø§Ù„Ø¬ÙŠØ§Ø³
          # Prompt Ù…ØµÙ…Ù… Ù„Ø·Ù„Ø¨ ÙƒÙˆØ¯ XML ÙÙ‚Ø·ØŒ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
          API_RESPONSE=$(curl -s -X POST "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyDK6iEgit-M6xjgF09-MBuggk5qUBYrJ-M" \
            -H "Content-Type: application/json" \
            -d '{
              "contents": [{
                "parts": [{
                  "text": "Generate ONLY the XML code for an Android Vector Drawable representing a stylized red Geass eye. Ensure the XML starts with <vector and ends with </vector>. No explanations, no markdown."
                }]
              }]
            }')
          
          # Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙƒÙˆØ¯ Ø§Ù„Ù€ XML Ù…Ù† Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù€ API ÙˆØªØ®Ø²ÙŠÙ†Ù‡ ÙÙŠ Ù…Ù„Ù
          # Ù†Ø³ØªØ®Ø¯Ù… Python Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø¯ ÙˆØ¶Ù…Ø§Ù† Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙƒÙˆØ¯ XML ØµØ§Ù„Ø­ ÙÙ‚Ø·
          # ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ØŒ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù ÙØ§Ø±Øº Ù„ØªØ¬Ù†Ø¨ Ø®Ø·Ø£
          echo "$API_RESPONSE" | python3 -c "import sys, json; 
          try: 
            text_content = json.load(sys.stdin)['candidates'][0]['content']['parts'][0]['text']
            # Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø¹Ù„Ø§Ù…Ø§Øª Markdown Ø£Ùˆ Ù†ØµÙˆØµ Ø¥Ø¶Ø§ÙÙŠØ©
            clean_xml = text_content.replace('```xml', '').replace('```', '').strip()
            print(clean_xml)
          except Exception: 
            print('<vector xmlns:android=\"http://schemas.android.com/apk/res/android\" android:width=\"24dp\" android:height=\"24dp\" android:viewportWidth=\"24\" android:viewportHeight=\"24\"><path android:fillColor=\"#FF0000\" android:pathData=\"M12,2C6.48,2 2,6.48 2,12s4.48,10 10,10 10,-4.48 10,-10S17.52,2 12,2z\"/></vector>') # fallback default eye
          " > ai_generated_eye.xml

          # Ø·Ø¨Ø§Ø¹Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ù„Ù„ØªØ­Ù‚Ù‚ (Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„ØªØµØ­ÙŠØ­)
          echo "Generated XML Content:"
          cat ai_generated_eye.xml
          echo ""

      - name: ğŸ—ï¸ Construct Android App Structure & Inject AI Asset
        run: |
          # Ù…Ø³Ø­ Ø£ÙŠ Ø¨Ù‚Ø§ÙŠØ§ Ø¨Ù†Ø§Ø¡ Ù‚Ø¯ÙŠÙ…Ø© Ù„Ø¶Ù…Ø§Ù† Ù†Ø¸Ø§ÙØ© Ø§Ù„Ø¨Ù†Ø§Ø¡
          rm -rf app

          # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
          mkdir -p app/src/main/java/com/geass/eye
          mkdir -p app/src/main/res/drawable
          mkdir -p app/src/main/res/layout
          mkdir -p app/src/main/res/values

          # Ø­Ù‚Ù† Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø°ÙŠ ÙˆÙ„Ø¯Ù‡ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙÙŠ Ù…Ø¬Ù„Ø¯ Drawable
          # Ù‡Ø°Ø§ ÙŠØ¶Ù…Ù† Ø£Ù† Ù…Ù„Ù ic_geass_eye.xml Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø¦Ù…Ø§Ù‹
          mv ai_generated_eye.xml app/src/main/res/drawable/ic_geass_eye.xml

          # Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù„ÙØ§Øª Gradle Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
          echo "android.useAndroidX=true" > gradle.properties
          echo "include ':app'" > settings.gradle

          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù build.gradle Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
          cat <<EOF > build.gradle
          buildscript {
              repositories { google(); mavenCentral() }
              dependencies { classpath 'com.android.tools.build:gradle:7.4.2' }
          }
          allprojects {
              repositories { google(); mavenCentral() }
          }
          EOF

          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù build.gradle Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
          cat <<EOF > app/build.gradle
          apply plugin: 'com.android.application'
          android {
              compileSdkVersion 31
              namespace 'com.geass.eye'
              defaultConfig {
                  applicationId "com.geass.eye"
                  minSdkVersion 21
                  targetSdkVersion 31
                  versionCode 12
                  versionName "12.0-AI-Generated-Build"
              }
          }
          dependencies {
              implementation 'androidx.appcompat:appcompat:1.4.1'
          }
          EOF

          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù AndroidManifest.xml
          cat <<EOF > app/src/main/AndroidManifest.xml
          <manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.geass.eye">
              <application android:label="Geass Eye AI" android:theme="@style/Theme.AppCompat.NoActionBar">
                  <activity android:name=".MainActivity" android:exported="true">
                      <intent-filter>
                          <action android:name="android.intent.action.MAIN" />
                          <category android:name="android.intent.category.LAUNCHER" />
                      </intent-filter>
                  </activity>
              </application>
          </manifest>
          EOF

          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Layout (activity_main.xml) Ø§Ù„Ø°ÙŠ ÙŠØ¹Ø±Ø¶ Ø§Ù„Ø¹ÙŠÙ† Ø§Ù„ØªÙŠ ØµÙ…Ù…Ù‡Ø§ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
          cat <<EOF > app/src/main/res/layout/activity_main.xml
          <RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
              android:layout_width="match_parent"
              android:layout_height="match_parent"
              android:background="#000000">
              <ImageView
                  android:layout_width="300dp"
                  android:layout_height="300dp"
                  android:layout_centerInParent="true"
                  android:src="@drawable/ic_geass_eye"
                  android:contentDescription="AI Generated Geass Eye" />
          </RelativeLayout>
          EOF

          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù MainActivity.java (Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚)
          cat <<EOF > app/src/main/java/com/geass/eye/MainActivity.java
          package com.geass.eye;
          import android.os.Bundle;
          import androidx.appcompat.app.AppCompatActivity;
          public class MainActivity extends AppCompatActivity {
              @Override
              protected void onCreate(Bundle savedInstanceState) {
                  super.onCreate(savedInstanceState);
                  setContentView(R.layout.activity_main);
              }
          }
          EOF

      - name: ğŸ”¨ Execute Gradle Build
        run: |
          wget -q https://services.gradle.org/distributions/gradle-7.5-bin.zip # ØªØ­Ù…ÙŠÙ„ Gradle
          unzip -q gradle-7.5-bin.zip # ÙÙƒ Ø¶ØºØ· Gradle
          ./gradle-7.5/bin/gradle :app:assembleDebug --no-daemon # Ø¨Ù†Ø§Ø¡ Ù…Ù„Ù Ø§Ù„Ù€ APK

      - name: ğŸ“¦ Release AI-Designed APK
        uses: softprops/action-gh-release@v1
        with:
          files: app/build/outputs/apk/debug/app-debug.apk # Ù…Ø³Ø§Ø± Ù…Ù„Ù Ø§Ù„Ù€ APK Ø§Ù„Ù…Ù†ØªØ¬
          name: "Geass Eye - AI Generated Design v12.0" # Ø§Ø³Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø±
          tag_name: "v12.0-ai-design" # ÙˆØ³Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø±
          body: "ØªÙ… Ø¨Ù†Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØµÙ…ÙŠÙ… Ø¹ÙŠÙ† Ø§Ù„Ø¬ÙŠØ§Ø³ Ø§Ù„Ù…ÙˆÙ„Ù‘Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø© Gemini 1.5 Flash API Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ø£Ø«Ù†Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨Ù†Ø§Ø¡." # ÙˆØµÙ Ø§Ù„Ø¥ØµØ¯Ø§Ø±
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # ØªÙˆÙƒÙ† GitHub Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª