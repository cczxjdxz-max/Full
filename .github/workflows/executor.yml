name: 33. Geass_Ultimate_Awakening
on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build_ultimate_geass:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“‚ Checkout Repository
        uses: actions/checkout@v4

      - name: â˜• Setup Java 11
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '11'

      - name: ğŸ¨ Create Resources (The Ritual)
        run: |
          mkdir -p app/src/main/res/drawable
          mkdir -p app/src/main/res/raw
          mkdir -p app/src/main/res/layout
          mkdir -p app/src/main/res/values
          mkdir -p app/src/main/java/com/geass/ultimate

          # 1. ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ø³Ø­Ø±ÙŠØ© (XML Vector)
          cat <<EOF > app/src/main/res/drawable/magic_array.xml
          <vector xmlns:android="http://schemas.android.com/apk/res/android"
              android:width="500dp" android:height="500dp" android:viewportWidth="100" android:viewportHeight="100">
              <path android:strokeColor="#FF0000" android:strokeWidth="0.4"
                  android:pathData="M50,5 A45,45 0,1,1 49.9,5 Z M50,12 A38,38 0,1,0 50.1,12 Z" />
              <path android:strokeColor="#AA0000" android:strokeWidth="0.2"
                  android:pathData="M50,0 L50,100 M0,50 L100,50 M20,20 L80,80 M80,20 L20,80" />
              <path android:strokeColor="#FF0000" android:strokeWidth="0.3"
                  android:pathData="M35,35 L65,35 L65,65 L35,65 Z" />
          </vector>
          EOF

          # 2. ØªØ­Ù…ÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¬ÙŠØ§Ø³
          wget -q -O app/src/main/res/raw/geass_sound.mp3 "https://www.myinstants.com/media/sounds/geass-eye-sound.mp3"

          # 3. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø³Ù…Ø§Øª
          cat <<EOF > app/src/main/res/values/colors.xml
          <resources>
              <color name="black">#000000</color>
              <color name="blood_red">#880000</color>
          </resources>
          EOF

      - name: ğŸ—ï¸ UI Layout (The Dark Screen)
        run: |
          cat <<EOF > app/src/main/res/layout/activity_main.xml
          <RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
              android:layout_width="match_parent"
              android:layout_height="match_parent"
              android:background="#000000"
              android:clipChildren="false">

              <ImageView
                  android:id="@+id/array_view"
                  android:layout_width="550dp"
                  android:layout_height="550dp"
                  android:layout_centerInParent="true"
                  android:src="@drawable/magic_array"
                  android:alpha="0" />

              <ImageView
                  android:id="@+id/eye_view"
                  android:layout_width="280dp"
                  android:layout_height="280dp"
                  android:layout_centerInParent="true"
                  android:src="@drawable/geass_eye"
                  android:alpha="0.8" />

              <TextView
                  android:id="@+id/status_text"
                  android:layout_width="wrap_content"
                  android:layout_height="wrap_content"
                  android:text="TAP TO AWAKEN"
                  android:textColor="#44FF0000"
                  android:layout_alignParentBottom="true"
                  android:layout_centerHorizontal="true"
                  android:layout_marginBottom="100dp"
                  android:textSize="18sp"
                  android:letterSpacing="0.4" />
          </RelativeLayout>
          EOF

      - name: ğŸ§  Main Logic (The Awakening)
        run: |
          cat <<EOF > app/src/main/java/com/geass/ultimate/MainActivity.java
          package com.geass.ultimate;
          import android.animation.*;
          import android.media.MediaPlayer;
          import android.os.*;
          import android.view.View;
          import android.view.animation.*;
          import android.widget.ImageView;
          import androidx.appcompat.app.AppCompatActivity;

          public class MainActivity extends AppCompatActivity {
              private MediaPlayer mp;
              private boolean active = false;

              @Override protected void onCreate(Bundle savedInstanceState) {
                  super.onCreate(savedInstanceState);
                  setContentView(R.layout.activity_main);

                  ImageView array = findViewById(R.id.array_view);
                  ImageView eye = findViewById(R.id.eye_view);
                  Vibrator vib = (Vibrator) getSystemService(VIBRATOR_SERVICE);

                  eye.setOnClickListener(v -> {
                      if (!active) {
                          active = true;
                          // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
                          mp = MediaPlayer.create(this, R.raw.geass_sound);
                          if (mp != null) mp.start();

                          // Ø§Ù‡ØªØ²Ø§Ø² Ù‚ÙˆÙŠ
                          if (vib != null) vib.vibrate(VibrationEffect.createOneShot(400, 255));

                          // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù…ØµÙÙˆÙØ© ÙˆØ¸Ù‡ÙˆØ±Ù‡Ø§
                          array.animate().alpha(0.6f).scaleX(1.2f).scaleY(1.2f).setDuration(1000).start();
                          ObjectAnimator rot = ObjectAnimator.ofFloat(array, "rotation", 0f, 360f);
                          rot.setDuration(8000);
                          rot.setRepeatCount(ValueAnimator.INFINITE);
                          rot.setInterpolator(new LinearInterpolator());
                          rot.start();

                          // Ù†Ø¨Ø¶ Ø§Ù„Ø¹ÙŠÙ† Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ
                          ObjectAnimator pulse = ObjectAnimator.ofPropertyValuesHolder(eye,
                              PropertyValuesHolder.ofFloat("scaleX", 1f, 1.15f),
                              PropertyValuesHolder.ofFloat("scaleY", 1f, 1.15f));
                          pulse.setDuration(600);
                          pulse.setRepeatMode(ValueAnimator.REVERSE);
                          pulse.setRepeatCount(ValueAnimator.INFINITE);
                          pulse.start();
                      }
                  });
              }
          }
          EOF

      - name: âš™ï¸ Project Config
        run: |
          echo "include ':app'" > settings.gradle
          cat <<EOF > app/build.gradle
          apply plugin: 'com.android.application'
          android { 
              compileSdkVersion 31
              namespace 'com.geass.ultimate'
              defaultConfig { applicationId "com.geass.ultimate"; minSdkVersion 26; targetSdkVersion 31; versionCode 33; versionName "33.0" }
          }
          dependencies { implementation 'androidx.appcompat:appcompat:1.4.1' }
          EOF
          
          cat <<EOF > app/src/main/AndroidManifest.xml
          <manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.geass.ultimate">
              <uses-permission android:name="android.permission.VIBRATE" />
              <application android:label="Geass Ultimate" android:theme="@style/Theme.AppCompat.NoActionBar">
                  <activity android:name=".MainActivity" android:exported="true">
                      <intent-filter> <action android:name="android.intent.action.MAIN" /> <category android:name="android.intent.category.LAUNCHER" /> </intent-filter>
                  </activity>
              </application>
          </manifest>
          EOF

      - name: ğŸ”¨ Final Compilation
        run: |
          wget -q https://services.gradle.org/distributions/gradle-7.5-bin.zip
          unzip -q gradle-7.5-bin.zip
          ./gradle-7.5/bin/gradle :app:assembleDebug --no-daemon

      - name: ğŸ“¦ Upload APK
        uses: softprops/action-gh-release@v1
        with:
          files: app/build/outputs/apk/debug/app-debug.apk
          tag_name: v33.0
          name: "Geass Ultimate Ritual v33.0"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}