name: 2. The Processor (Full) - 5 Trillion Simulation & GIF
on:
  repository_dispatch:
    types: [headless_reverse]

permissions:
  contents: write

jobs:
  run_simulation:
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout Code"
        uses: actions/checkout@v4

      - name: "Install Engineering Tools"
        run: |
          python -m pip install --upgrade pip
          pip install numpy matplotlib pillow

      - name: "Execute Headless Training & Generate GIF"
        run: |
          echo "${{ github.event.client_payload.plan }}" | base64 -d > engine_core.py
          python3 engine_core.py

      - name: "Deploy Final God Brain and GIF"
        uses: softprops/action-gh-release@v1
        with:
          files: |
            god_reverse_brain.dat
            final_decapitated_round.gif # ملف الـ GIF الجديد
          name: "The-Decapitated-Brain-v${{ github.run_id }}"
          tag_name: "final-god-v${{ github.run_id }}"
          body: "العقل النهائي بعد 5 تريليون محاكاة بفيزياء حقيقية. الفيديو يوضح آخر جولة."
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}