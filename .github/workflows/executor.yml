name: 2. The Executor (BODY)

on:
  repository_dispatch:
    types: [execute_extraction_plan]

jobs:
  execute_the_plan:
    runs-on: ubuntu-latest
    steps:
      - name: "Acknowledge order and receive the plan"
        id: receive_plan
        run: |
          # استلام الخطة (السكربت) من حمولة المدير
          # وحفظها في ملف لتنفيذها
          echo '${{ github.event.client_payload.plan }}' > miner_script.py

      - name: "Prepare environment for execution"
        run: chmod +x miner_script.py

      - name: "Execute the Manager's plan"
        env:
          GAME_DOWNLOAD_URL: "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk"
        run: |
          echo "Executing the plan designed by The Manager..."
          python3 miner_script.py

      - name: "Secure the extracted assets"
        run: |
          echo "Packaging results..."
          zip -r core_data.zip CORE_DATA

      - name: "Report success by creating a Release"
        uses: softprops/action-gh-release@v1
        with:
          # سيتم إنشاء الإصدار في هذا المستودع (Full)
          files: core_data.zip
          name: "Extraction-Report-${{ github.run_id }}"
          tag_name: "data-v${{ github.run_id }}"
          body: "Mission accomplished as per The Manager's plan. Core data secured."
        env:
          # GITHUB_TOKEN الخاص بهذا المستودع
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}