name: 2. The Executor (BODY) - State-Aware & Strict

on:
  repository_dispatch:
    types: [evolve_and_execute]

permissions:
  contents: write

jobs:
  execute_evolutionary_plan:
    runs-on: ubuntu-latest
    steps:
      - name: "Restore Previous State"
        uses: actions/cache/restore@v4
        id: cache-restore
        with:
          path: .
          key: state-${{ github.run_id }}
          restore-keys: |
            state-

      - name: "Receive and Write Plan"
        run: |
          python3 -c "import os, json; open('plan_script.py', 'w').write(json.loads(os.environ['PLAN_PAYLOAD'])['plan_script'])"
        env:
          PLAN_PAYLOAD: ${{ toJSON(github.event.client_payload) }}

      - name: "Execute the Manager's Plan"