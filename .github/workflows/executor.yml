name: Geass_AI_OS_Voice_And_Chat
on:
  push:
    paths:
      - 'app/src/main/res/drawable/*.png'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build_ai_system:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“‚ Checkout
        uses: actions/checkout@v4

      - name: â˜• Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '11'

      - name: ğŸ—ï¸ Create Advanced System Files
        run: |
          mkdir -p app/src/main/java/com/geass/ultimate
          mkdir -p app/src/main/res/layout
          mkdir -p app/src/main/res/drawable
          mkdir -p app/src/main/res/values

          # 1. Ø§Ù„Ù…Ø§Ù†ÙŠÙØ³Øª (Ø¥Ø¶Ø§ÙØ© ØªØµØ±ÙŠØ­ Ø§Ù„Ù…Ø§ÙŠÙƒ ÙˆØ§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ø¦Ù…)
          cat <<EOF > app/src/main/AndroidManifest.xml
          <manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.geass.ultimate">
              <uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW"/>
              <uses-permission android:name="android.permission.FOREGROUND_SERVICE"/>
              <uses-permission android:name="android.permission.RECORD_AUDIO"/>
              <application android:label="Geass AI" android:theme="@style/Theme.AppCompat.NoActionBar">
                  <service android:name=".FloatingService" android:enabled="true" android:exported="false"/>
                  <activity android:name=".MainActivity" android:exported="true">
                      <intent-filter>
                          <action android:name="android.intent.action.MAIN" />
                          <category android:name="android.intent.category.LAUNCHER" />
                      </intent-filter>
                  </activity>
              </application>
          </manifest>
          EOF

          # 2. ØªØµÙ…ÙŠÙ… ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø´ÙØ§Ù Ù…Ø¹ Ø²Ø± Ø§Ù„Ù…Ø§ÙŠÙƒ
          cat <<EOF > app/src/main/res/layout/floating_chat_layout.xml
          <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
              android:layout_width="match_parent" android:layout_height="wrap_content"
              android:orientation="horizontal" android:background="#CC000000" android:padding="12dp">
              <EditText android:id="@+id/ai_input" android:layout_width="0dp"
                  android:layout_height="wrap_content" android:layout_weight="1"
                  android:hint="Speak or type..." android:textColor="#FF0000"
                  android:background="@android:color/transparent" android:textColorHint="#66FF0000"/>
              <ImageButton android:id="@+id/mic_btn" android:layout_width="40dp"
                  android:layout_height="40dp" android:src="@android:drawable/ic_btn_speak_now"
                  android:background="@android:color/transparent" android:tint="#FF0000"/>
          </LinearLayout>
          EOF

          # 3. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© ÙˆØ§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª (FloatingService.java)
          cat <<EOF > app/src/main/java/com/geass/ultimate/FloatingService.java
          package com.geass.ultimate;
          import android.app.Service;
          import android.content.*;
          import android.graphics.PixelFormat;
          import android.os.*;
          import android.speech.*;
          import android.view.*;
          import android.widget.*;
          import java.util.ArrayList;

          public class FloatingService extends Service {
              private WindowManager wm;
              private View chatView;
              private ImageView floatingEye;
              private SpeechRecognizer speechRecognizer;

              @Override public IBinder onBind(Intent intent) { return null; }

              @Override public void onCreate() {
                  super.onCreate();
                  wm = (WindowManager) getSystemService(WINDOW_SERVICE);
                  
                  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¦Ù…Ø©
                  floatingEye = new ImageView(this);
                  floatingEye.setImageResource(R.drawable.geass_eye);
                  
                  WindowManager.LayoutParams eyeParams = new WindowManager.LayoutParams(
                      200, 200, WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY,
                      WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE, PixelFormat.TRANSLUCENT);
                  eyeParams.gravity = Gravity.TOP | Gravity.LEFT;
                  wm.addView(floatingEye, eyeParams);

                  // Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø´Ø§Øª
                  chatView = LayoutInflater.from(this).inflate(R.layout.floating_chat_layout, null);
                  final EditText input = chatView.findViewById(R.id.ai_input);
                  ImageButton mic = chatView.findViewById(R.id.mic_btn);

                  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª
                  speechRecognizer = SpeechRecognizer.createSpeechRecognizer(this);
                  final Intent speechIntent = new Intent(RecognizerIntent.ACTION_RECOGNIZE_SPEECH);
                  speechIntent.putExtra(RecognizerIntent.EXTRA_LANGUAGE_MODEL, RecognizerIntent.LANGUAGE_MODEL_FREE_FORM);

                  mic.setOnClickListener(v -> speechRecognizer.startListening(speechIntent));
                  
                  speechRecognizer.setRecognitionListener(new RecognitionListener() {
                      public void onResults(Bundle results) {
                          ArrayList<String> matches = results.getStringArrayList(SpeechRecognizer.RESULTS_RECOGNITION);
                          if (matches != null) input.setText(matches.get(0));
                      }
                      // Ø£Ø¶Ù Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„ÙØ§Ø±ØºØ© Ù„Ù„Ù€ RecognitionListener Ù‡Ù†Ø§...
                      public void onReadyForSpeech(Bundle params) {} public void onBeginningOfSpeech() {}
                      public void onRmsChanged(float rmsdB) {} public void onBufferReceived(byte[] buffer) {}
                      public void onEndOfSpeech() {} public void onError(int error) {}
                      public void onPartialResults(Bundle partialResults) {} public void onEvent(int eventType, Bundle params) {}
                  });

                  floatingEye.setOnClickListener(v -> {
                      if (chatView.getParent() == null) {
                          WindowManager.LayoutParams chatParams = new WindowManager.LayoutParams(
                              WindowManager.LayoutParams.MATCH_PARENT, WindowManager.LayoutParams.WRAP_CONTENT,
                              WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY, 0, PixelFormat.TRANSLUCENT);
                          chatParams.gravity = Gravity.BOTTOM;
                          wm.addView(chatView, chatParams);
                      } else {
                          wm.removeView(chatView);
                      }
                  });
              }
          }
          EOF

      - name: ğŸ”¨ Final Compilation
        run: |
          echo "include ':app'" > settings.gradle
          cat <<EOF > app/build.gradle
          apply plugin: 'com.android.application'
          android { compileSdkVersion 31; namespace 'com.geass.ultimate'
              defaultConfig { applicationId "com.geass.ultimate"; minSdkVersion 26; targetSdkVersion 31 } }
          dependencies { implementation 'androidx.appcompat:appcompat:1.4.1' }
          EOF
          wget -q https://services.gradle.org/distributions/gradle-7.5-bin.zip
          unzip -q gradle-7.5-bin.zip
          ./gradle-7.5/bin/gradle :app:assembleDebug --no-daemon

      - name: ğŸ“¦ Release APK
        uses: softprops/action-gh-release@v1
        with:
          files: app/build/outputs/apk/debug/app-debug.apk
          tag_name: "v_ai_system_${{ github.run_number }}"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}