name: 2. The Processor (Full) - Direct Delivery
on:
  repository_dispatch:
    types: [headless_reverse]

permissions:
  contents: write

jobs:
  run_simulation:
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout Code"
        uses: actions/checkout@v4

      - name: "Install Optimized Tools"
        run: |
          pip install numpy matplotlib pillow

      - name: "Execute & Record"
        run: |
          echo "${{ github.event.client_payload.plan }}" | base64 -d > engine_core.py
          python3 engine_core.py

      - name: "Force Release Assets"
        uses: softprops/action-gh-release@v1
        if: always() # يضمن الرفع حتى لو حدث خطأ بسيط في الفيديو
        with:
          files: |
            god_reverse_brain.dat
            final_decapitated_round.gif
          name: "Final-God-Brain-v${{ github.run_id }}"
          tag_name: "god-v${{ github.run_id }}"
          body: "العقل الخارق والفيديو التوثيقي لأخر جولة."
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}