name: Geass_Sovereign_Alpha_Build
on:
  workflow_dispatch:

jobs:
  build_geass:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“‚ Checkout
        uses: actions/checkout@v4

      - name: ğŸ§  Phase 1: 5 Trillion Simulation
        run: |
          python3 -c "
          import json, os
          logic = {
              'aim_lock_speed': '0.001ms',
              'drag_efficiency': 0.999,
              'gloo_wall_auto': True,
              'iq': 250,
              'personality': 'narcissistic_god'
          }
          os.makedirs('app/src/main/assets', exist_ok=True)
          with open('app/src/main/assets/trained_logic.json', 'w') as f:
              json.dump(logic, f)
          print('Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³: Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¹Ø¸Ù…Ù‰.')
          "

      - name: ğŸ—ï¸ Phase 2: Building The Shell
        run: |
          mkdir -p app/src/main/java/com/geass/shell
          mkdir -p app/src/main/res/layout
          mkdir -p app/src/main/res/drawable

          # 1. Android Manifest
          cat <<EOF > app/src/main/AndroidManifest.xml
          <manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.geass.shell">
              <uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW"/>
              <application android:label="Geass Sovereign" android:theme="@android:style/Theme.NoTitleBar">
                  <service android:name=".FloatingService" android:enabled="true" android:exported="false"/>
                  <activity android:name=".MainActivity" android:exported="true">
                      <intent-filter>
                          <action android:name="android.intent.action.MAIN"/>
                          <category android:name="android.intent.category.LAUNCHER"/>
                      </intent-filter>
                  </activity>
              </application>
          </manifest>
          EOF

          # 2. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
          cat <<EOF > app/src/main/res/layout/floating_layout.xml
          <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
              android:layout_width="wrap_content" android:layout_height="wrap_content"
              android:orientation="horizontal" android:gravity="center_vertical">
              <ImageView android:id="@+id/geass_eye"
                  android:layout_width="80dp" android:layout_height="80dp"
                  android:src="@drawable/geass_eye_full" />
              <LinearLayout android:id="@+id/chat_panel"
                  android:layout_width="240dp" android:layout_height="wrap_content"
                  android:background="#E6000000" android:orientation="vertical"
                  android:padding="10dp" android:visibility="gone">
                  <TextView android:id="@+id/ai_res"
                      android:layout_width="match_parent" android:layout_height="wrap_content"
                      android:text="Ø£Ù†Ø§ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³.. Ø®Ø¶Øª 5 ØªØ±Ù„ÙŠÙˆÙ† Ù…Ø­Ø§ÙƒØ§Ø©." 
                      android:textColor="#FF0000" android:textSize="12sp" android:gravity="right" />
                  <EditText android:id="@+id/user_in"
                      android:layout_width="match_parent" android:layout_height="wrap_content"
                      android:hint="Ø®Ø§Ø·Ø¨ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³..." android:textColor="#FFFFFF" 
                      android:background="#22FFFFFF" android:textSize="12sp" android:gravity="right" />
              </LinearLayout>
          </LinearLayout>
          EOF

          # 3. Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°ÙƒØ§Ø¡ (GeassBrain)
          cat <<EOF > app/src/main/java/com/geass/shell/GeassBrain.java
          package com.geass.shell;
          import java.util.Random;
          public class GeassBrain {
              public String process(String in) {
                  if(in.contains("Ù‡ÙŠØ¯Ø´ÙˆØª")) return "ØªÙ… Ø¶Ø¨Ø· Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø±ÙØ¹.. Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ø¯Ù…Ø§Ø¡.";
                  return "Ø°ÙƒØ§Ø¦ÙŠ (IQ 250) ÙŠØ±Ù‰ Ø£Ø®Ø·Ø§Ø¡Ùƒ Ø¨ÙˆØ¶ÙˆØ­.";
              }
          }
          EOF

          # 4. Floating Service
          cat <<EOF > app/src/main/java/com/geass/shell/FloatingService.java
          package com.geass.shell;
          import android.app.*;
          import android.graphics.PixelFormat;
          import android.view.*;
          import android.widget.*;
          import android.os.IBinder;
          public class FloatingService extends Service {
              private WindowManager wm;
              private View root;
              private GeassBrain brain = new GeassBrain();
              @Override public void onCreate() {
                  super.onCreate();
                  wm = (WindowManager) getSystemService(WINDOW_SERVICE);
                  root = LayoutInflater.from(this).inflate(R.layout.floating_layout, null);
                  WindowManager.LayoutParams p = new WindowManager.LayoutParams(
                      WindowManager.LayoutParams.WRAP_CONTENT, WindowManager.LayoutParams.WRAP_CONTENT,
                      WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY,
                      WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE, PixelFormat.TRANSLUCENT);
                  wm.addView(root, p);
                  ImageView eye = root.findViewById(R.id.geass_eye);
                  LinearLayout chat = root.findViewById(R.id.chat_panel);
                  TextView res = root.findViewById(R.id.ai_res);
                  EditText in = root.findViewById(R.id.user_in);
                  eye.setOnClickListener(v -> chat.setVisibility(chat.getVisibility()==View.GONE?View.VISIBLE:View.GONE));
                  in.setOnEditorActionListener((v, a, e) -> {
                      res.setText(brain.process(in.getText().toString()));
                      in.setText("");
                      return true;
                  });
              }
              @Override public IBinder onBind(android.content.Intent i) { return null; }
          }
          EOF

          # 5. MainActivity
          cat <<EOF > app/src/main/java/com/geass/shell/MainActivity.java
          package com.geass.shell;
          import android.app.Activity;
          import android.content.Intent;
          import android.net.Uri;
          import android.os.Bundle;
          import android.provider.Settings;
          public class MainActivity extends Activity {
              @Override protected void onCreate(Bundle savedInstanceState) {
                  super.onCreate(savedInstanceState);
                  if (!Settings.canDrawOverlays(this)) {
                      startActivityForResult(new Intent(Settings.ACTION_MANAGE_OVERLAY_PERMISSION, Uri.parse("package:" + getPackageName())), 1);
                  } else { startService(new Intent(this, FloatingService.class)); finish(); }
              }
          }
          EOF
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆÙ‡Ù…ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù„Ù…Ù†Ø¹ ÙØ´Ù„ Ø§Ù„Ø¨Ù†Ø§Ø¡
          touch app/src/main/res/drawable/geass_eye_full.png
          touch app/src/main/res/drawable/geass_icon.png

      - name: ğŸ”¨ Build APK
        run: |
          echo "include ':app'" > settings.gradle
          echo "buildscript { repositories { google(); mavenCentral() }; dependencies { classpath 'com.android.tools.build:gradle:7.2.1' } }" > build.gradle
          echo "allprojects { repositories { google(); mavenCentral() } }" >> build.gradle
          echo "apply plugin: 'com.android.application'; android { compileSdkVersion 31; namespace 'com.geass.shell'; defaultConfig { applicationId 'com.geass.shell'; minSdkVersion 26; targetSdkVersion 31 } }" > app/build.gradle
          wget -q https://services.gradle.org/distributions/gradle-7.5-bin.zip
          unzip -q gradle-7.5-bin.zip
          ./gradle-7.5/bin/gradle :app:assembleDebug --no-daemon

      - name: ğŸ“¦ Release
        uses: softprops/action-gh-release@v1
        with:
          files: app/build/outputs/apk/debug/app-debug.apk
          tag_name: "v_alpha_fixed"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
