name: GIAS_MASTER_PIPELINE

on:
  workflow_dispatch: # للسماح بالتشغيل اليدوي

jobs:
  build_digital_twin_assets:
    runs-on: ubuntu-latest

    steps:
      # الخطوة 1: تنزيل الحزمة الكاملة مباشرة
      - name: 1. Download Full Game Package
        run: |
          echo "--- Downloading the 501MB unified APK from Garena's CDN ---"
          # استخدام الرابط الذي أثبتت أنه يعمل
          curl -L "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk" -o GamePackage.apk --progress-bar
          echo "\n--- Download Complete. Verifying size... ---"
          ls -lh GamePackage.apk

      # الخطوة 2: تفكيك الحزمة للوصول إلى الأصول
      - name: 2. Unpack the Game Package
        run: |
          sudo apt-get update && sudo apt-get install -y unzip
          mkdir game_assets
          # هذا الملف الكبير هو في الأساس ملف ZIP
          unzip GamePackage.apk -d ./game_assets
          echo "--- Package Unpacked ---"
          ls -lR ./game_assets

      # الخطوة 3: استخراج الأصول القابلة للاستخدام
      - name: 3. Export Usable Assets
        run: |
          echo "--- Downloading AssetStudioCLI ---"
          curl -L "https://github.com/Perfare/AssetStudio/releases/download/v0.17.25/AssetStudio.CLI_net6_linux-x64.zip" -o assetstudio.zip
          unzip assetstudio.zip -d AssetStudioCLI
          chmod +x ./AssetStudioCLI/AssetStudio.CLI

          echo "--- Starting automated asset export ---"
          mkdir exported_assets
          # مسح المجلد بأكمله الذي يحتوي على الأصول المفككة
          ./AssetStudioCLI/AssetStudio.CLI ./game_assets ./exported_assets
          echo "--- Asset Export Finished ---"

      # الخطوة 4: رفع الأصول النهائية لمشروعك
      - name: 4. Upload Final Assets for Digital Twin
        uses: actions/upload-artifact@v4
        with:
          name: Digital-Twin-Assets
          path: ./exported_assets/