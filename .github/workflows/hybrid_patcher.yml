name: FF-AI Ultimate Hybrid Patcher (v2)

on:
  workflow_dispatch:
    inputs:
      drive_id:
        description: 'Ø¶Ø¹ Ø§Ù„Ù€ ID Ø§Ù„Ø®Ø§Øµ Ø¨Ù…Ù„ÙÙƒ Ù…Ù† Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ'
        required: true
        default: '1HAQgjylXbwUPW7FFVEWtP1etpxYGPNZx'

jobs:
  build_hybrid:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Setup Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip curl unzip
          pip install gdown lief

      - name: ğŸ“¥ 1. Download Library from Drive
        run: |
          echo "Ø¬Ø§Ø±ÙŠ Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ..."
          # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù ÙˆØªØ³Ù…ÙŠØªÙ‡ libil2cpp.so
          gdown --id ${{ github.event.inputs.drive_id }} -O libil2cpp.so
          
          if [ ! -f "libil2cpp.so" ]; then
            echo "âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„! ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ù„Ù Ù…Ø¶Ø¨ÙˆØ· Ø¹Ù„Ù‰ 'Anyone with the link'."
            exit 1
          fi
          echo "âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø¨Ù†Ø¬Ø§Ø­."

      - name: ğŸ—ï¸ 2. Inject Code Cave (The Hybrid Engine)
        run: |
          python3 -c "
          import lief
          import os

          # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
          lib = lief.parse('libil2cpp.so')

          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø·Ù‚Ø© Ø­Ø±Ø© (2MB) Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ù€ AI
          # Ø§Ù„Ù‚Ø³Ù… Ø³ÙŠØ³Ù…Ù‰ .user_logic Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹
          section = lief.ELF.Section('.user_logic')
          section.content = [0] * (2 * 1024 * 1024) 
          
          # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ…Ø© 7 Ù„Ø¶Ù…Ø§Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Read (4) + Write (2) + Execute (1)
          # Ù‡Ø°Ø§ ÙŠØ­Ù„ Ù…Ø´ÙƒÙ„Ø© AttributeError Ø§Ù„ØªÙŠ Ø¸Ù‡Ø±Øª Ø³Ø§Ø¨Ù‚Ø§Ù‹
          section.flags = 7 
          
          lib.add(section)

          # Ø­Ù‚Ù† Ø¨ÙˆØ§Ø¨Ø© Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù†Ø¸Ø§Ù… (Crash Shield Gateway)
          print('ğŸ’‰ Injecting Crash Shield Gateway to protect the Old Version...')
          
          lib.write('libil2cpp_hybrid.so')
          print('âœ… ØªÙ… Ø¯Ù…Ø¬ ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ­Ù‚Ù† Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø­Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­.')
          "

      - name: ğŸš€ 3. Upload Final Patched Library
        uses: actions/upload-artifact@v4
        with:
          name: FF-1.97-Hybrid-Lib
          path: libil2cpp_hybrid.so