name: FF-1.97.1-Hybrid-Patcher-50MB

on:
  workflow_dispatch:
    inputs:
      drive_id:
        description: 'ID Ù…Ù„Ù Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ'
        required: true
        default: '1HAQgjylXbwUPW7FFVEWtP1etpxYGPNZx'

jobs:
  build_50mb_patch:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Setup Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip curl unzip file
          pip install gdown lief

      - name: ğŸ“¥ 1. Download & Prepare Lib
        run: |
          gdown --id ${{ github.event.inputs.drive_id }} -O archive.zip
          unzip -o archive.zip -d temp_folder
          find temp_folder -name "libil2cpp.so" -exec mv {} ./libil2cpp.so \;
          
          if [ ! -f "libil2cpp.so" ]; then
            echo "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø²ÙŠØ¨!"
            exit 1
          fi
          echo "âœ… Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© (116MB) Ø¬Ø§Ù‡Ø²Ø©."

      - name: ğŸ—ï¸ 2. Inject 50MB Space (The Dragon Cave)
        run: |
          python3 -c "
          import lief
          import sys

          lib = lief.parse('libil2cpp.so')
          if lib is None:
              sys.exit(1)

          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø·Ù‚Ø© 50 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª (52,428,800 Ø¨Ø§ÙŠØª)
          ultra_size = 50 * 1024 * 1024
          section = lief.ELF.Section('.dragon_cave')
          
          # Ù†Ù…Ù„Ø£Ù‡Ø§ Ø¨Ø§Ù„Ø£ØµÙØ§Ø± Ù„ØªÙƒÙˆÙ† Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ÙƒØªØ§Ø¨Ø©
          section.content = [0] * ultra_size
          
          # ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©: Ù‚Ø±Ø§Ø¡Ø©ØŒ ÙƒØªØ§Ø¨Ø©ØŒ ØªÙ†ÙÙŠØ° (R-W-X)
          section.flags = 7 
          
          lib.add(section)
          
          print('ğŸ’‰ Injected 50MB successfully into the 116MB Lib!')
          lib.write('libil2cpp_50mb.so')
          "

      - name: ğŸš€ 3. Upload Result (Ready for MT Manager)
        uses: actions/upload-artifact@v4
        with:
          name: FF-1.97.1-50MB-Ready
          path: libil2cpp_50mb.so