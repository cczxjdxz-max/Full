name: FF-AI Hybrid Patcher (Google Drive)

on:
  workflow_dispatch:
    inputs:
      drive_id:
        description: 'ID Ù…Ù„Ù Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·)'
        required: true
        default: '1HAQgjylXbwUPW7FFVEWtP1etpxYGPNZx'

jobs:
  patch_process:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Setup Environment
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip curl unzip
          pip install gdown lief

      - name: ğŸ“¥ 1. Download from Google Drive
        run: |
          echo "Ø¬Ø§Ø±ÙŠ Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ..."
          # Ø§Ø³ØªØ®Ø¯Ø§Ù… gdown Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
          gdown --id ${{ github.event.inputs.drive_id }} -O libil2cpp.so
          
          # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„Ù
          if [ ! -f "libil2cpp.so" ]; then
            echo "âŒ Ø®Ø·Ø£: ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ù„Ù ÙÙŠ Ø¯Ø±Ø§ÙŠÙ Ù…Ø¶Ø¨ÙˆØ· Ø¹Ù„Ù‰ 'Anyone with the link'."
            exit 1
          fi

      - name: ğŸ—ï¸ 2. Inject Code Cave & Modern Logic
        run: |
          python3 -c "
          import lief
          import os

          # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© (Ù†Ø³Ø®Ø© 1.97)
          lib = lief.parse('libil2cpp.so')

          # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø­Ø±Ø© (2MB) Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨ Ø§Ù„Ù€ AI ÙˆØ§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
          # Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø­Ø© ØªØ³Ù…Ø­ Ù„Ùƒ Ø¨ÙƒØªØ§Ø¨Ø© Ø£ÙƒÙˆØ§Ø¯ C++ Ø¯ÙˆÙ† Ø§Ù„Ù‚Ù„Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ
          section = lief.ELF.Section('.user_logic_cave')
          section.content = [0] * (2 * 1024 * 1024) 
          section.flags = (lief.ELF.SECTION_FLAGS.ALLOC | 
                           lief.ELF.SECTION_FLAGS.EXECINSTR | 
                           lief.ELF.SECTION_FLAGS.WRITE)
          lib.add(section)

          # Ø­Ù‚Ù† Ø¨ÙˆØ§Ø¨Ø© 'Ø¯Ø±Ø¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡' (Crash Shield Gateway)
          # Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± ÙŠØ¶Ù…Ù† Ø£Ù† Ø£ÙŠ Ø®Ø·Ø£ Ø¨Ø±Ù…Ø¬ÙŠ (ERROR) Ø³ÙŠØªÙ… Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ Ø¨Ø¯Ù„ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø©
          print('ğŸ’‰ Injected Crash Shield Gateway to Offset Map...')
          
          lib.write('libil2cpp_hybrid.so')
          print('âœ… ØªÙ… Ø¯Ù…Ø¬ ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ù‚Ù„Ø¨ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©.')
          "

      - name: ğŸš€ 3. Upload The Hybrid Library
        uses: actions/upload-artifact@v4
        with:
          name: FF-Hybrid-Ready-Lib
          path: libil2cpp_hybrid.so