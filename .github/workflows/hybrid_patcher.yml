name: FF-AI Hybrid Patcher (Zip Handler)

on:
  workflow_dispatch:
    inputs:
      drive_id:
        description: 'ID Ù…Ù„Ù Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ'
        required: true
        default: '1HAQgjylXbwUPW7FFVEWtP1etpxYGPNZx'

jobs:
  build_hybrid:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Setup Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip curl unzip file
          pip install gdown lief

      - name: ğŸ“¥ 1. Download and Extract Zip
        run: |
          echo "Ø¬Ø§Ø±ÙŠ Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¶ØºÙˆØ· Ù…Ù† Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ..."
          gdown --id ${{ github.event.inputs.drive_id }} -O archive.zip
          
          echo "ğŸ“¦ Ø¬Ø§Ø±ÙŠ ÙÙƒ Ø¶ØºØ· Ø§Ù„Ø£Ø±Ø´ÙŠÙ..."
          unzip -o archive.zip -d extracted_files
          
          echo "ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„Ù libil2cpp.so Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª..."
          # Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± Ø³ÙŠØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù„Ù Ù…Ù‡Ù…Ø§ ÙƒØ§Ù† Ù…ÙƒØ§Ù†Ù‡ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø²ÙŠØ¨ ÙˆÙŠÙ†Ù‚Ù„Ù‡ Ù„Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
          find extracted_files -name "libil2cpp.so" -exec mv {} ./libil2cpp.so \;
          
          if [ ! -f "libil2cpp.so" ]; then
            echo "âŒ Ø®Ø·Ø£: Ù„Ù… Ù†Ø¬Ø¯ Ù…Ù„Ù libil2cpp.so Ø¯Ø§Ø®Ù„ Ù…Ù„Ù Ø§Ù„Ù€ Zip!"
            exit 1
          fi
          echo "âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­Ø¬Ù…Ù‡Ø§: $(du -h libil2cpp.so | cut -f1)"

      - name: ğŸ—ï¸ 2. Inject Code Cave & Modern Logic
        run: |
          python3 -c "
          import lief
          import sys

          # ÙØªØ­ Ø§Ù„Ù…Ù„Ù Ø¨Ø¹Ø¯ Ø§Ø³ØªØ®Ø±Ø§Ø¬Ù‡ Ù…Ù† Ø§Ù„Ø²ÙŠØ¨
          lib = lief.parse('libil2cpp.so')
          if lib is None:
              print('âŒ ÙØ´Ù„ LIEF ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬!')
              sys.exit(1)

          # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø­Ø±Ø© (2MB)
          section = lief.ELF.Section('.user_logic')
          section.content = [0] * (2 * 1024 * 1024) 
          section.flags = 7 # R-W-X
          
          lib.add(section)
          lib.write('libil2cpp_hybrid.so')
          print('âœ… ØªÙ… Ø­Ù‚Ù† Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø­Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­.')
          "

      - name: ğŸš€ 3. Upload Result
        uses: actions/upload-artifact@v4
        with:
          name: FF-Hybrid-Ready-Lib
          path: libil2cpp_hybrid.so