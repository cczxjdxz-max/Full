name: FF 1.97.1 Offline Patcher

on:
  workflow_dispatch:

jobs:
  patch_process:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install gdown
        run: pip install gdown

      - name: Download Libil2cpp
        run: |
          gdown --id 1HAQgjylXbwUPW7FFVEWtP1etpxYGPNZx -O libil2cpp.so

      - name: Apply Master Patch (Offline + Skins)
        run: |
          python3 -c "
          import os

          def patch_lib(offset, hex_code):
              with open('libil2cpp.so', 'r+b') as f:
                  f.seek(offset)
                  f.write(bytes.fromhex(hex_code))
                  print(f'Patched: {hex(offset)}')

          # --- أوفستات إصدار 1.97.1 (ARM64) ---
          
          # 1. كسر فحص الاتصال بالإنترنت (Network Check Bypass)
          # نجعل الدالة ترجع True دائماً (0100A0E31EFF2FE1)
          patch_lib(0x315168c, '0100A0E31EFF2FE1') 

          # 2. كسر حماية تسجيل الدخول (Login Skip)
          patch_lib(0x3184e38, '0100A0E31EFF2FE1')

          # 3. تفعيل السكنات من ملفات الـ Data (Local Assets Unlock)
          # هذه الدالة تجبر اللعبة على قراءة الملفات المحلية بدلاً من التحقق من السيرفر
          patch_lib(0x30bc4f0, '0100A0E31EFF2FE1')
          "

      - name: Upload Patched Artifact
        uses: actions/upload-artifact@v4
        with:
          name: FF-1.97.1-Offline-Fixed
          path: libil2cpp.so