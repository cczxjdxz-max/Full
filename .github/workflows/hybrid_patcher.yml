name: FF-AI Hybrid Patcher (10MB Mega Cave)

on:
  workflow_dispatch:
    inputs:
      drive_id:
        description: 'ID Ù…Ù„Ù Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ'
        required: true
        default: '1HAQgjylXbwUPW7FFVEWtP1etpxYGPNZx'

jobs:
  build_mega_hybrid:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Setup Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip curl unzip file
          pip install gdown lief

      - name: ğŸ“¥ 1. Download and Extract
        run: |
          echo "Ø¬Ø§Ø±ÙŠ Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ..."
          gdown --id ${{ github.event.inputs.drive_id }} -O archive.zip
          
          echo "ğŸ“¦ ÙÙƒ Ø§Ù„Ø¶ØºØ· ÙˆØ§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙƒØªØ¨Ø©..."
          unzip -o archive.zip -d temp_folder
          find temp_folder -name "libil2cpp.so" -exec mv {} ./libil2cpp.so \;
          
          if [ ! -f "libil2cpp.so" ]; then
            echo "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ libil2cpp.so!"
            exit 1
          fi

      - name: ğŸ—ï¸ 2. Inject 10MB Mega Cave
        run: |
          python3 -c "
          import lief
          import sys

          lib = lief.parse('libil2cpp.so')
          if lib is None:
              sys.exit(1)

          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø·Ù‚Ø© Ø­Ø±Ø© Ø¶Ø®Ù…Ø© (10 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª)
          # 10 * 1024 * 1024 = 10,485,760 bytes
          mega_size = 10 * 1024 * 1024
          section = lief.ELF.Section('.user_logic_mega')
          section.content = [0] * mega_size
          
          # ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©: Read + Write + Execute
          section.flags = 7 
          
          lib.add(section)
          
          # Ø¥Ø¶Ø§ÙØ© 'ÙˆØ³Ù…' Ø®Ø§Øµ Ù„Ù„Ù…Ù†Ø·Ù‚Ø© Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„ÙŠÙ‡Ø§ ÙÙŠ MT Manager
          print('ğŸ’‰ Mega Cave (10MB) Injected Successfully!')
          
          lib.write('libil2cpp_10mb_hybrid.so')
          "

      - name: ğŸš€ 3. Upload Mega Library
        uses: actions/upload-artifact@v4
        with:
          name: FF-10MB-Hybrid-Lib
          path: libil2cpp_10mb_hybrid.so