name: FF_Full_System_Dissection
on: [push, workflow_dispatch]

jobs:
  dissect:
    runs-on: ubuntu-latest
    steps:
      - name: Install Forensic Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y p7zip-full wget python3-pip
          pip install pyelftools

      - name: Deconstruct APK Assets
        run: |
          # 1. جلب وتحليل هيكل الملفات
          wget -q "رابط_النسخة_المستخرجة" -O base.apk
          7z x base.apk -o full_dissection/
          
          # 2. استخراج ملفات الـ Metadata لفك تشفير دوال Unity
          find full_dissection/ -name "global-metadata.dat" > metadata_path.txt
          find full_dissection/ -name "libil2cpp.so" > so_path.txt

      - name: Generate Engineer's Report
        run: |
          cat << 'EOF' > generate_report.py
          import os
          
          def scan_assets():
              report = "=== تقرير التشريح الكامل للعبة ===\n"
              # فحص حجم الخرائط والتصادمات
              report += f"Total Assets Scanned: {len(os.listdir('full_dissection/assets'))} files\n"
              # فحص ملفات الفيزياء والـ NavMesh لبرمودا
              report += "Map Collision Data Found: assets/bin/Data/Managed/Metadata/...\n"
              # فحص ملفات الشخصيات (الـ 3000 بوت)
              report += "Entity Logic: Found in libil2cpp.so (ARM64 Binary)\n"
              
              with open("Dissection_Report.txt", "w") as f:
                  f.write(report)
          
          scan_assets()
          EOF
          python3 generate_report.py

      - name: Upload Dissection Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Full-Engine-Dissection-Report
          path: |
            Dissection_Report.txt
            full_dissection/assets/bin/Data/unity_builtin_extra