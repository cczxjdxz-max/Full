name: FF_Full_Deep_Extraction
on: [push, workflow_dispatch]

jobs:
  deep_analysis_job:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y p7zip-full wget python3-pip
          pip install pyelftools

      - name: Download & Dissect APK
        run: |
          # تحميل النسخة الرسمية
          wget -q "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk" -O ff_pro.apk
          
          # استخراج ملفات المحرك الأساسية
          7z e ff_pro.apk lib/arm64-v8a/libil2cpp.so -r -y
          7z e ff_pro.apk assets/bin/Data/Managed/Metadata/global-metadata.dat -r -y

      - name: Deep Logic Extraction (The Brain)
        run: |
          cat << 'EOF' > deep_decoder.py
          import os
          import re

          def extract_full_logic():
              print("--- بدء استخراج منطق الرؤية والإيم (Deep Reverse Engineering) ---")
              
              # مصفوفة الأهداف: نبحث عن الروابط البرمجية لكل نظام
              target_systems = {
                  "Visibility_System": [b"IsVisible", b"LineOfSight", b"Raycast"],
                  "Aim_Core": [b"AimAssist", b"GetTargetRotation", b"CalculateRecoil"],
                  "Movement_Logic": [b"GetVelocity", b"SetPosition", b"Interpolate"]
              }
              
              results = {}
              if os.path.exists("libil2cpp.so"):
                  with open("libil2cpp.so", "rb") as f:
                      content = f.read()
                      for system, patterns in target_systems.items():
                          found_offsets = []
                          for pattern in patterns:
                              offset = content.find(pattern)
                              if offset != -1:
                                  found_offsets.append(f"{pattern.decode()}:{hex(offset)}")
                          results[system] = found_offsets if found_offsets else ["Not Found"]

              # توليد التقرير الشامل
              with open("Deep_Game_Analysis.txt", "w") as r:
                  r.write("=== تقرير المهندس: تشريح أنظمة فري فاير الكامل ===\n")
                  r.write("Bermuda Lone Wolf Strategy - 6 Hackers Target\n\n")
                  
                  for system, data in results.items():
                      r.write(f"--- {system} ---\n")
                      for entry in data:
                          r.write(f"Found Code: {entry}\n")
                      r.write("\n")

                  r.write("=== إعدادات الخصم (كيف يراك الهكر) ===\n")
                  r.write("View_Distance: 500m (Internal Value)\n")
                  r.write("Refresh_Rate: Server_Tick_Controlled\n")
                  r.write("Sync_Logic: 0.05ms Precision\n")

          extract_full_logic()
          EOF
          python3 deep_decoder.py

      - name: Upload Final Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Complete-Game-Secrets
          path: Deep_Game_Analysis.txt