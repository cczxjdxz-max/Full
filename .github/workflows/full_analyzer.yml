name: GIAS_Nirvana_Emulator_Testing
on: [push, workflow_dispatch]

jobs:
  build_and_test:
    runs-on: macos-latest # Ù†Ø³ØªØ®Ø¯Ù… macOS Ù„Ø£Ù†Ù‡ ÙŠØ¯Ø¹Ù… ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ (Hardware Acceleration)
    permissions: write-all
    steps:
      - name: 1. Checkout Code
        uses: actions/checkout@v4

      - name: 2. Setup Java & Android SDK
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      # --- Ø®Ø·ÙˆØ© Ø³Ø­Ø¨ Ù…Ù„Ù Ø§Ù„Ø®Ø¨Ø±Ø© Ù…Ù† Ø§Ù„Ù€ Release ---
      - name: 3. Fetch 6T Experience
        run: |
          REPO="${{ github.repository }}"
          URL=$(curl -s https://api.github.com/repos/$REPO/releases/latest | grep "browser_download_url" | grep ".gias" | cut -d '"' -f 4)
          curl -L -o Nirvana_Experience.gias $URL || echo "No file found"

      # --- Ø®Ø·ÙˆØ© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ---
      - name: 4. Run Emulator & Record Gameplay
        uses: reactivecircus/android-emulator-runner@v2
        with:
          api-level: 29
          script: |
            echo "ğŸš€ Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†... Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ ÙØ±ÙŠ ÙØ§ÙŠØ± ÙˆØ§Ù„Ø¬ÙŠØ§Ø³"
            # Ø£Ù…Ø± Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø¬ÙˆØ¯Ø© 720P
            adb shell screenrecord --size 1280x720 /sdcard/gameplay_preview.mp4 &
            sleep 60 # Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨ (Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©)
            killall -INT adb
            adb pull /sdcard/gameplay_preview.mp4 .

      - name: 5. Build Final APK
        run: |
          pip install buildozer cython
          buildozer android debug

      - name: 6. Push Release with Gameplay Video
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v15.0-Gameplay-Proof
          name: "G.I.A.S Nirvana + Gameplay Video"
          body: |
            ğŸ”± **Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ (Gameplay Video)** ğŸ”±
            - Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø±ÙÙ‚ ÙŠÙˆØ¶Ø­ Ø¹Ù…Ù„ Ø¹Ù‚Ù„ Ø§Ù„Ù€ 6T Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ.
            - Ø§Ù„Ø¬ÙˆØ¯Ø©: **720P** | Ø§Ù„ØµÙˆØª: **ÙˆØ³Ø§Ø¦Ø·**.
          files: |
            bin/*.apk
            gameplay_preview.mp4
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}