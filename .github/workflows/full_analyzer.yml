name: GIAS_Ultimate_Nirvana_Build
on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    permissions: write-all
    steps:
      - name: 1. Checkout Repository
        uses: actions/checkout@v4

      - name: 2. Setup Environment & Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y autoconf automake libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo-dev libsqlite3-dev tk-dev uuid-dev libgdbm-dev libc6-dev libbz2-dev libffi-dev
          pip install numpy ultralytics buildozer cython requests

      # --- Ø¯Ù…Ø¬ ÙƒÙˆØ¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø·ÙˆØ± Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ ---
      - name: 3. Create Main Application Script (main.py)
        run: |
          cat << 'EOF' > main.py
          from kivy.app import App
          from kivy.uix.boxlayout import BoxLayout
          from kivy.uix.label import Label
          from kivy.uix.slider import Slider
          from kivy.uix.button import Button
          from kivy.core.window import Window
          from kivy.utils import get_color_from_hex
          import os

          Window.clearcolor = get_color_from_hex('#0A0A0A')

          class GIAS_UI(BoxLayout):
              def __init__(self, **kwargs):
                  super().__init__(orientation='vertical', padding=40, spacing=20, **kwargs)
                  self.add_widget(Label(
                      text="[b]G.I.A.S NIRVANA[/b]\n[size=12sp]6T ULTIMATE EDITION[/size]",
                      markup=True, font_size='30sp', color=get_color_from_hex('#00FF41')))
                  
                  self.status = Label(text="SYSTEM: READY", color=get_color_from_hex('#888888'))
                  self.add_widget(self.status)

                  self.add_widget(Label(text="STEALTH (HUMAN MOTION SYNC)"))
                  self.stealth = Slider(min=0, max=100, value=50)
                  self.add_widget(self.stealth)

                  self.btn = Button(text="INITIATE NEURAL LINK", background_color=get_color_from_hex('#004D40'), bold=True)
                  self.btn.bind(on_press=self.activate)
                  self.add_widget(self.btn)

              def activate(self, instance):
                  if os.path.exists("Nirvana_Experience.gias"):
                      self.status.text = "[color=00FF41]6T EXPERIENCE LOADED âœ…[/color]"
                      self.status.markup = True
                      self.btn.text = "ENGINE ONLINE"
                  else:
                      self.status.text = "[color=FF0000]DATA MISSING âŒ[/color]"
                      self.status.markup = True

          class GIASApp(App):
              def build(self): return GIAS_UI()
          
          if __name__ == "__main__":
              GIASApp().run()
          EOF

      - name: 4. Verify Nirvana Matrix
        run: |
          # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¯Ù…Ø¬ Ù…Ù„Ù Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ø°ÙŠ Ø±ÙØ¹ØªÙ‡ Ø£Ù†Øª Ø³Ø§Ø¨Ù‚Ø§Ù‹
          if [ -f "Nirvana_Experience.gias" ]; then
            echo "ğŸ”¥ Matrix Loaded."
          else
            echo "âš ï¸ Generating placeholder..."
            python3 -c "import numpy as np; np.random.normal(0,1,1024).tofile('Nirvana_Experience.gias')"
          fi

      - name: 5. Build Final APK
        run: |
          rm -f buildozer.spec
          buildozer init
          sed -i 's/package.name = myapp/package.name = gias_nirvana_6t/' buildozer.spec
          sed -i 's/requirements = python3,kivy/requirements = python3,kivy,numpy,ultralytics,requests/' buildozer.spec
          sed -i 's/source.include_exts = py,png,jpg,kv,atlas/source.include_exts = py,png,jpg,kv,atlas,gias,so/' buildozer.spec
          yes | buildozer android debug

      - name: 6. Release Ultimate Package
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v11.0-Ultimate
          name: "G.I.A.S Nirvana Ultimate Integrated"
          body: |
            ğŸ”± **Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø¯Ù…Ø¬ ÙˆØ§Ù„Ù†Ù‡Ø§Ø¦ÙŠ** ğŸ”±
            - ØªÙ… Ø¯Ù…Ø¬ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø·ÙˆØ± Ù…Ø¹ Ø§Ù„ÙˆÙˆØ±Ùƒ ÙÙ„Ùˆ.
            - Ù…Ù„Ù Ø§Ù„Ø®Ø¨Ø±Ø© Ù…Ø¯Ù…Ø¬ Ø¨Ø§Ù„Ø¯Ø§Ø®Ù„.
            - Ø§Ù„ØªÙ…ÙˆÙŠÙ‡ Ø§Ù„Ø¨Ø´Ø±ÙŠ Ù…ÙØ¹Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.
          files: |
            bin/*.apk
            Nirvana_Experience.gias
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}