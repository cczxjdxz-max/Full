name: FF_All_In_One_Decompiler
on: [push, workflow_dispatch]

jobs:
  ultimate_extraction:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y p7zip-full wget python3-pip
          pip install pyelftools

      - name: Download & Extract & Analyze
        run: |
          # 1. تحميل اللعبة من الرابط الرسمي
          echo "--- جاري تحميل النسخة الرسمية ---"
          wget -q "https://dl.cdn.freefiremobile.com/live/package/FreeFire.apk" -O ff_live.apk

          # 2. فك ضغط الملفات الحساسة (المحرك والبيانات)
          echo "--- فك تشريح الـ APK ---"
          7z e ff_live.apk lib/arm64-v8a/libil2cpp.so -r
          7z e ff_live.apk assets/bin/Data/Managed/Metadata/global-metadata.dat -r

          # 3. إنشاء سكريبت التحليل وتشغيله فوراً
          cat << 'EOF' > decoder.py
          import os
          import struct

          def run_analysis():
              print("--- بدء تحليل المتجهات والبيانات الثنائية ---")
              results = {}
              
              if os.path.exists("libil2cpp.so"):
                  with open("libil2cpp.so", "rb") as f:
                      # البحث عن قيم فيزيائية افتراضية (سرعة، جاذبية، إحداثيات)
                      # هذه الأنماط تساعد الـ AI في فهم قوانين برمودا
                      content = f.read()
                      
                      # أمثلة لأنماط البحث عن الهيدشوت والسرعة
                      search_patterns = {
                          "Vector_Engine": b"\x00\x00\xA0\x41", # تمثيل 20.0f
                          "Speed_Limit": b"\x00\x00\x40\x40",   # تمثيل 3.0f
                          "Health_Address": b"\x00\x00\x96\x43" # تمثيل 300.0f
                      }
                      
                      for name, pattern in search_patterns.items():
                          offset = content.find(pattern)
                          results[name] = hex(offset) if offset != -1 else "Dynamic"

              with open("Final_AI_Report.txt", "w") as r:
                  r.write("=== تقرير الذكاء الاصطناعي: نسخة برمودا الذئب الوحيد ===\n")
                  r.write("Targeting 6 Hackers (HP: 1800 Total)\n")
                  r.write(f"Environment: Headless Offline Simulation\n")
                  r.write("-" * 40 + "\n")
                  for k, v in results.items():
                      r.write(f"{k} Base Offset: {v}\n")
                  r.write("\n=== إحداثيات التدريب المستخرجة ===\n")
                  r.write("Map_ID: Bermuda_LoneWolf\n")
                  r.write("AI_Spawn: [165.0, 200.0]\n")
                  r.write("Hacker_Cluster_Center: [175.0, 210.0]\n")

          run_analysis()
          EOF

          python3 decoder.py

      - name: Upload Report
        uses: actions/upload-artifact@v4
        with:
          name: AI-Game-Report
          path: Final_AI_Report.txt